{"version":3,"sources":["components/characterDisplay/PowerDetails.module.scss","components/CharacterDisplay.module.scss","components/MembershipSelect/MembershipSelect.module.scss","components/MembershipHeader/MembershipHeader.module.scss","components/characterDisplay/PowerBars.module.scss","components/characterDisplay/CharacterLinks.module.scss","components/characterDisplay/InterPowerBar.module.scss","components/LoadingSpinner/LoadingSpinner.module.scss","services/config.ts","services/debug.ts","services/events.ts","services/bungie-api.ts","services/ga.ts","services/bungie-auth.ts","components/characterDisplay/CharacterLinks.tsx","constants.ts","services/masterwork.ts","components/characterDisplay/PowerBar.tsx","components/characterDisplay/PowerBars.tsx","components/characterDisplay/InterPowerBar.tsx","components/characterDisplay/Power.tsx","components/characterDisplay/PowerDetails.tsx","components/characterDisplay/PowerHints.tsx","components/CharacterDisplay.tsx","components/FetchSpinner/index.ts","components/FetchSpinner/FetchSpinner.tsx","components/BuildStamp/BuildStamp.tsx","components/BuildStamp/index.ts","components/KoFi/index.ts","components/KoFi/KoFi.tsx","images/icons/Ko-fi_Icon_RGBforDarkBg_sm.png","images/icons/github.svg","images/icons/twitter.svg","services/utils.ts","services/vendor-engrams.ts","components/SocialLinks/index.ts","components/SocialLinks/SocialLinks.tsx","components/Footer/index.ts","components/Footer/Footer.tsx","components/LoggedOutHeader/index.ts","components/LoggedOutHeader/Header.tsx","components/LoadingChecklist/LoadingChecklist.tsx","components/LoadingSpinner/index.ts","components/LoadingSpinner/LoadingSpinner.tsx","components/LazyImage.tsx","images/screenshots/example-titan-character-display-with-info-blur.jpg","images/screenshots/example-titan-character-display-with-info.png","components/LoginPrompt/LoginPrompt.tsx","components/LoginPrompt/index.ts","components/MembershipSelect/MembershipSelect.tsx","components/MembershipSelect/index.ts","services/api.ts","components/RedactedWarning/index.ts","components/RedactedWarning/RedactedWarning.tsx","components/MembershipHeader/MembershipHeader.tsx","components/MembershipHeader/index.ts","components/GetTrackingPermission.tsx","App.tsx","serviceWorker.ts","index.tsx","App.module.scss","components/GetTrackingPermission.module.scss","components/LoadingChecklist/LoadingChecklist.module.scss","components/LazyImage.module.scss","components/FetchSpinner/FetchSpinner.module.scss","components/SocialLinks/SocialLinks.module.scss","components/LoggedOutHeader/Header.module.scss","components/LoginPrompt/LoginPrompt.module.scss","components/Footer/Footer.module.scss","components/KoFi/KoFi.module.scss","components/RedactedWarning/RedactedWarning.module.scss","components/characterDisplay/PowerHints.module.scss","components/characterDisplay/PowerBar.module.scss","components/characterDisplay/Power.module.scss","components/BuildStamp/BuildStamp.module.scss"],"names":["module","exports","BUNGIE_OAUTH_TOKEN_URL","process","REACT_APP_BUNGIE_API_KEY","REACT_APP_BUNGIE_OAUTH_CLIENT_ID","REACT_APP_BUNGIE_OAUTH_CLIENT_SECRET","Error","BUNGIE_API_KEY","BUNGIE_OAUTH_CLIENT_ID","BUNGIE_OAUTH_CLIENT_SECRET","EVENTS","eventEmitter","EventEmitter","useEvent","eventName","handler","savedHandler","useRef","useEffect","current","eventListener","eventData","addListener","removeListener","ee","oldEmit","emit","args","apply","getCachedManifestDataPromise","cachedManifestData","getManifestPromise","initialized","ga","ReactGA","init","initialize","pageview","set","event","anonymizeIp","window","location","pathname","search","BungieSystemDisabledError","bungieAuthedFetch","config","a","accessToken","getAccessToken","headers","Authorization","url","params","Object","entries","map","key","value","encodeURIComponent","requestConfig","method","credentials","body","JSON","stringify","fetch","response","status","UNAUTHED_FETCH_ERROR","json","messageData","ErrorStatus","toString","MANIFEST_VERSION_KEY","MANIFEST_IDB_KEY","manifestPropertyList","getCachedManifestData","get","manifestData","getUserLanguage","LANG_PATTERN","queryParams","URLSearchParams","queryLang","test","queryUseUserLang","toLowerCase","navigator","language","navLanguage","substr","getRemoteManifestData","manifest","version","FETCH_MANIFEST_DATA","manifestUrls","jsonWorldComponentContentPaths","en","Promise","all","prop","then","manifestDataArray","reduce","acc","i","STORE_MANIFEST_DATA","localStorage","setItem","clearStoredManifest","removeItem","del","undefined","MANIFEST_FETCH_ERROR","clearDestinyManifest","console","log","getManifest","resolve","pendingGetCachedManifestData","category","action","nonInteraction","GET_MANIFEST","getDestinyManifest","localStorageManifestVersion","getItem","manifestVersion","Response","includes","LOAD_MANIFEST_DATA","every","error","freshManifestData","result","MANIFEST_DATA_READY","catch","err","getBasicProfile","membershipType","membershipId","getProfile","components","destinyMembershipId","getFullProfile","setItemLockState","payload","setItemLockStateApi","ACCESS_TOKEN_STORAGE_KEY","ACCESS_TOKEN_EXPIRY_STORAGE_KEY","REFRESH_TOKEN_STORAGE_KEY","REFRESH_TOKEN_EXPIRY_STORAGE_KEY","BUNGIE_MEMBERSHIP_ID_STORAGE_KEY","DESTINY_MEMBERSHIPS_STORAGE_KEY","DESTINY_MEMBERSHIP_STORAGE_KEY","MANUAL_AUTHED_STORAGE_KEY","on","clearStorage","hasManuallyAuthed","getAuthUrl","response_type","client_id","client_secret","hasNavigated","redirectToAuth","assign","e","manualStartAuth","autoSelectDestinyMembership","destinyMemberships","length","setSelectedDestinyMembership","crossSavePrimaryMemberships","filter","m","crossSaveOverride","nonCrossSaveMemberships","handleTokenResponse","tokenResponse","data","access_token","tokenDuration","expires_in","expiryTime","Date","now","refreshToken","refresh_token","refreshTokenDuration","refresh_expires_in","refreshExpiryTime","bungieMembershipId","membership_id","getMembershipDataById","destinyMembershipsResponse","authSuccess","selectedMembership","getSelectedDestinyMembership","some","fetchAccessToken","authCode","grant_type","code","cache","redirect","referrer","refreshAccessToken","handleResult","hasValidAccessToken","accessTokenExpiryTime","parseInt","hasValidRefreshToken","refreshTokenExpiryTime","hasValidAuth","accessTokenIsValid","getDestinyMemberships","destinyMembershipsString","parse","message","hasDestinyMemberships","destinyMembershipString","memberships","hasSelectedDestinyMembership","membership","auth","authResponse","history","replaceState","document","title","origin","isAccessTokenValid","isRefreshTokenValid","logOut","LOG_OUT","link","text","tags","linkText","URL","hostname","href","target","rel","className","classnames","tag","STYLES","RAID_AND_DUNGEON_REPORT_PLATFORMS","1","2","3","4","5","CharacterLinks","characterId","onImageExportClick","useState","isHidden","setHidden","characterLinks","hide","content","onClick","ITEM_SLOT_KINETIC","ITEM_SLOT_ENERGY","ITEM_SLOT_POWER","ITEM_SLOT_HEAD","ITEM_SLOT_GLOVES","ITEM_SLOT_CHEST","ITEM_SLOT_LEGS","ITEM_SLOT_CLASS_ITEM","ITEM_SLOT_BUCKETS","ITEM_BUCKET_SLOTS","buckets","slot","bucket","ORDERED_ITEM_SLOTS","ITEM_TYPE_ARMOR","ITEM_TYPE_WEAPON","CLASS_NAMES","ITEM_POWER_SOFT_CAP","ITEM_POWER_POWERFUL_CAP","ITEM_POWER_PINNACLE_CAP","isMasterwork","item","state","PowerBar","min","max","avgValue","label","icon","isMasterworked","itemName","itemType","isEquipped","range","perc","Math","floor","avgPerc","fullLabelText","locationLabel","getLocationLabel","specificItemLabel","fullLabel","power","belowAverage","slotName","generalLabel","specificLabel","barWrapper","iconWrapper","src","alt","vaultOverlay","postmasterOverlay","masterworkOverlay","barContainer","filledBar","style","width","barLine","left","classItemNames","hunter","titan","warlock","PowerBars","itemsBySlot","useUnrestrictedPower","unrestrictedOverallPowerExact","overallPowerExact","topUnrestrictedItemBySlot","topItemBySlot","powerBySlot","slots","instanceData","primaryStat","overallPower","roundedPower","minItemPower","values","minPowerToDisplay","maxItemPower","maxItemPowerGrouping","maxPowerToDisplay","ceil","powerBars","powerRange","minPower","rangeLine","maxPower","bars","bestItem","chest","classItem","energy","gloves","head","kinetic","legs","itemDefinition","displayProperties","name","itemCategories","parentCategoryHashes","itemTypeDisplayName","character","powerLabel","indicator","InterPowerBar","extraValue","valueToUse","fillPerc","extraFillPerc","interPowerBar","bar","extraFillBar","fillBar","barOverlay","numberWithSign","Power","children","withSign","inlinePowerNumber","ProgressBar","withThousands","n","replace","progressBar","progressBarFill","progressBarOverlay","PowerDetails","artifactData","unrestrictedOverallPower","powerToDisplay","bonusPower","details","detailsRow","detailsLabel","detailsValue","detailsInlineIcon","iconPath","progressToNextLevel","nextLevelAt","PowerHints","potentialOverallPower","onChangeUseUnrestrictedPower","powerToUseExact","powerToUse","powerRequiredToReachNext","powerRequiredToReachPotential","pinnacleDropPowerDisplay","hints","hint","dropHint","legendaryWorldDropHint","hintExtra","hintExtraInner","worldDropHint","powerfulHint","pinnacleHint","toggleCheckbox","type","checked","switch","BLACK_RGB","red","green","blue","FALLBACK_EMBLEM_RGB","HAKKE_EMBLEM_RGB","CharacterDisplay","onDragStart","onDragEnd","onDragDrop","addClasses","elementRef","domToImage","saveAs","toBlob","blob","useRenderElementImage","renderImage","setUseUnrestrictedPower","summableArtifactBonusPower","backgroundColor","ref","isDragging","setIsDragging","isDraggingOver","setIsDraggingOver","characterDisplayWrapper","dragging","dragOver","onDragEnter","onDragOver","stopPropagation","preventDefault","onDragLeave","onDrop","draggable","dragOverlay","CharacterDisplayBodyWrapper","rgbString","emblemColor","characterDisplay","header","emblemBackground","withTitle","toUpperCase","hasRedacted","hasRedactedEquippableItems","headerOverlayBar","newValue","FetchSpinner","fetchSpinnerContainer","anchor","spinner","spinnerSmall","gitHead","BuildStamp","buildStamp","KoFi","kofiContainer","height","border","_extends","arguments","source","prototype","hasOwnProperty","call","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","d","SvgGithub","_ref","svgRef","titleId","props","role","viewBox","id","ForwardRef","SvgTwitter","lastManifestResult","lastAllCharacterItemsHash","lastItemInstancesHash","lastProfileProgressionHash","lastCharacterData","vendorEngramsData","vendorEngramsRefreshTimer","vendorEngramsRefreshPromise","SocialLinks","socialLinks","fill","Footer","withMobilePadding","footer","relative","copy","Header","headerContainer","subHeader","author","LoadingChecklist","items","withTopMargin","topMargin","LoadingSpinner","loading","spinnerLarge","spinnerLargeDouble","spinnerSmallDouble","LazyImage","lowResImage","highResImage","highResImageLoaded","setHighResImageLoaded","onHighResImageLoad","useCallback","lazyImage","hidden","overlay","onLoad","DEFAULT_ON_LOGIN_CLICK","LoginPrompt","onLoginClick","loginContainer","exampleImage","ExampleTitanCharacterDisplayImageLowRes","ExampleTitanCharacterDisplayImage","login","loginButton","PLATFORMS","isCrossSavePrimary","isCrossSaveSecondary","CrossSaveDisplay","applicableMembershipTypes","crossSaveDisplayWrapper","crossSaveDisplay","t","s","titleCase","join","crossSaveIcon","crossSaveMembershipIcon","MembershipSelect","onMembershipSelect","api","bungieAuth","membershipSelect","crossSaveActive","crossSaveDisabled","membershipDisplayName","displayName","CHARACTER_DISPLAY_ORDER_STORAGE_KEY","CACHED_CHARACTER_DATA_STORAGE_KEY","loadCharacterDisplayOrder","storedValue","saveCharacterDisplayOrder","characterOrder","getPowerBySlot","mapValues","getAveragePower","sum","getOverallPower","getPower","averagePower","mergeItems","characterItemMap","allItems","characterItems","concat","mapAndFilterItems","itemInstances","itemInstanceId","DestinyInventoryItemDefinition","itemHash","itemCategoryHashes","c","DestinyItemCategoryDefinition","inventory","bucketTypeHash","equipRequiredLevel","baseCharacterLevel","classType","cannotEquipReason","canEquip","isItemEquippableByCharacter","getItemScore","priorityItems","score","pi","getEquipLabel","equippingBlock","uniqueLabel","getDataForCharacterId","characters","equippedCharacterItems","allCharacterItems","profileInventories","profileProgression","relevantProfileItems","redacted","equippable","groupBy","maxBy","uniqueEquippedGroups","forIn","uniqueEquippedGroup","validEquippableItemCombinations","forEach","otherItems","otherItem","isCombinationValid","combination","nonExotics","push","bestCombination","sumBy","bucketHash","artifactItemComponent","find","artifactInstance","seasonalArtifact","artifactDefinition","powerBonus","powerBonusProgression","potentialPowerBySlot","tempPotentialOverallPower","titleDefinition","DestinyRecordDefinition","titleRecordHash","titleInfo","titlesByGenderHash","genderHash","hashObject","hash","charCodeAt","simpleNumericalHash","getCachedCharacterData","setCharacterData","dataString","parsedData","isFetchingCharacterData","getIsFetchingCharacterData","bustProfileCache","characterData","char","v","isLocked","itemId","FETCHING_CHARACTER_DATA_CHANGE","getCharacterData","pendingManifest","destinyMembership","fullProfile","characterEquipment","characterInventories","profileInventory","itemComponents","instances","characterEquipments","manifestResult","newAllCharacterItemsHash","newItemInstancesHash","newProfileProgressionHash","queryNoCache","characterIds","VENDOR_ENGRAMS_DROP_NO_DATA","VENDOR_ENGRAMS_DROP_LOW","VENDOR_ENGRAMS_DROP_HIGH","VENDOR_DISPLAY_NAMES","devrim","sloane","failsafe","asher","zavala","shaxx","banshee","fanboy","bray","werner","getVendorDisplayName","shorthand","refreshVendorEngramsData","jsonData","updateTimestamp","getVendorEngramsData","setInterval","warn","bungieApi","utils","vendors","RedactedWarning","showMore","setShowMore","setHide","redactedMoreLink","redactedLessLink","redactedHideLink","redactedWarningMessage","links","redactedWarning","defaultOnLogout","MembershipHeader","onRefreshClick","onLogout","membershipHeader","hardRefreshButton","disabled","hardRefreshIcon","hardRefreshText","logOutButton","logOutIcon","logOutText","GetTrackingPermission","onGivePermission","onDenyPermission","getTrackingPermission","floater","buttons","yes","no","doAuth","throttle","setIsAuthed","setAuthError","doGetManifest","setBungieSystemDisabled","setBungieServiceUnavailable","setManifestError","doGetCharacterData","updateCharacterData","newData","newOverallPower","newArtifactPower","newTotalPower","dimension1","dimension2","dimension3","doHardRefresh","AppWrapper","top","tracking","getLocalStorageTrackingEnabled","trackingPermissionGiven","setTrackingPermissionGiven","trackingPermissionDenied","getLocalStorageTrackingDenied","trackingPermissionChoiceMade","gaInit","App","AppInner","setLocalStorageTrackingEnabled","setLocalStorageTrackingDenied","disableManualLogin","setDisableManualLogin","isAuthed","hasAuthError","hasManifestError","isBungieSystemDisabled","isBungieServiceUnavailable","setIsFetchingCharacterData","manifestState","setManifestState","PARSE_MANIFEST_DATA","hasManifestData","hasLoadedCachedCharacterData","setHasLoadedCachedCharacterData","hasSelectedMembership","useInterval","onSelectMembership","statusAuthError","getDefaultCharacterDisplayOrder","isValidCharacterDisplayOrder","draggingCharacterId","setDraggingCharacterId","characterDisplayOrder","setCharacterDisplayOrder","dropOnCharacterId","dropCharacterId","currentCharacterOrder","swappedOrder","slice","splice","useCharacterOrder","showRedactedWarning","charactersContainer","LoggedOutHeader","loadingChecklistItems","addToChecklist","isComplete","isFailed","Boolean","match","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.3adeebe5.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"details\":\"PowerDetails_details__IauWE\",\"detailsRow\":\"PowerDetails_detailsRow__3dZ8x\",\"detailsLabel\":\"PowerDetails_detailsLabel__3neH6\",\"detailsInlineIcon\":\"PowerDetails_detailsInlineIcon__2b7ok\",\"detailsValue\":\"PowerDetails_detailsValue__gft-h\",\"progressBar\":\"PowerDetails_progressBar__2noga\",\"progressBarFill\":\"PowerDetails_progressBarFill__diV_K\",\"progressBarOverlay\":\"PowerDetails_progressBarOverlay__N_EmM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"characterDisplayWrapper\":\"CharacterDisplay_characterDisplayWrapper__2yghq\",\"dragOverlay\":\"CharacterDisplay_dragOverlay__3MjTg\",\"dragOver\":\"CharacterDisplay_dragOver__2Zc9p\",\"dragging\":\"CharacterDisplay_dragging__3xBLG\",\"characterDisplay\":\"CharacterDisplay_characterDisplay__1QQWN\",\"header\":\"CharacterDisplay_header__oCh8Y\",\"emblemBackground\":\"CharacterDisplay_emblemBackground__1MwF0\",\"emblemSecondarySpecial\":\"CharacterDisplay_emblemSecondarySpecial__2Md7v\",\"emblemSecondaryOverlay\":\"CharacterDisplay_emblemSecondaryOverlay__3pccR\",\"name\":\"CharacterDisplay_name__2Ew4q\",\"power\":\"CharacterDisplay_power__2SSo9\",\"title\":\"CharacterDisplay_title__2Y46y\",\"withTitle\":\"CharacterDisplay_withTitle__33iMN\",\"hasRedacted\":\"CharacterDisplay_hasRedacted__2QSBF\",\"headerOverlayBar\":\"CharacterDisplay_headerOverlayBar__2q7Ln\",\"content\":\"CharacterDisplay_content__1VkC4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"membershipSelect\":\"MembershipSelect_membershipSelect__3hfE_\",\"membership\":\"MembershipSelect_membership__3k8sM\",\"membershipDisplayName\":\"MembershipSelect_membershipDisplayName__1DyLg\",\"platform_xbox\":\"MembershipSelect_platform_xbox__1ZFMp\",\"platform_psn\":\"MembershipSelect_platform_psn__3gGoO\",\"platform_steam\":\"MembershipSelect_platform_steam__1zogp\",\"platform_blizzard\":\"MembershipSelect_platform_blizzard__3mWPl\",\"platform_stadia\":\"MembershipSelect_platform_stadia__pid1g\",\"crossSaveDisplayWrapper\":\"MembershipSelect_crossSaveDisplayWrapper__3lF0I\",\"crossSaveDisplay\":\"MembershipSelect_crossSaveDisplay__ch469\",\"crossSaveIcon\":\"MembershipSelect_crossSaveIcon__j6hr8\",\"crossSaveMembershipIcon\":\"MembershipSelect_crossSaveMembershipIcon__3ljYz\",\"crossSaveMembershipType_xbox\":\"MembershipSelect_crossSaveMembershipType_xbox__1RMis\",\"crossSaveMembershipType_psn\":\"MembershipSelect_crossSaveMembershipType_psn__3oMbj\",\"crossSaveMembershipType_steam\":\"MembershipSelect_crossSaveMembershipType_steam__2eWG_\",\"crossSaveMembershipType_blizzard\":\"MembershipSelect_crossSaveMembershipType_blizzard__1bagE\",\"crossSaveMembershipType_stadia\":\"MembershipSelect_crossSaveMembershipType_stadia__3UsOn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"membershipHeader\":\"MembershipHeader_membershipHeader__2eIro\",\"membershipSelect\":\"MembershipHeader_membershipSelect__2YP0c\",\"hardRefreshButton\":\"MembershipHeader_hardRefreshButton__3JDYQ\",\"hardRefreshIcon\":\"MembershipHeader_hardRefreshIcon__3SjXD\",\"hardRefreshText\":\"MembershipHeader_hardRefreshText__2zdLA\",\"disabled\":\"MembershipHeader_disabled__1R3X_\",\"logOutButton\":\"MembershipHeader_logOutButton__35p57\",\"logOutIcon\":\"MembershipHeader_logOutIcon__E69SJ\",\"logOutText\":\"MembershipHeader_logOutText__3ljLV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"powerBars\":\"PowerBars_powerBars__hDv3O\",\"powerRange\":\"PowerBars_powerRange__1swNV\",\"rangeLine\":\"PowerBars_rangeLine__hNDDT\",\"powerLabel\":\"PowerBars_powerLabel__1HeOD\",\"indicator\":\"PowerBars_indicator__3ePkp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"characterLinks\":\"CharacterLinks_characterLinks__3yRkJ\",\"content\":\"CharacterLinks_content__m3ER_\",\"link\":\"CharacterLinks_link__2LuWX\",\"linkText\":\"CharacterLinks_linkText__3ZevI\",\"link_tag_dim\":\"CharacterLinks_link_tag_dim__NcQhr\",\"link_tag_braytech\":\"CharacterLinks_link_tag_braytech__32RNe\",\"link_tag_destinysets\":\"CharacterLinks_link_tag_destinysets__1wTSG\",\"link_tag_d2checklist\":\"CharacterLinks_link_tag_d2checklist__moPQz\",\"link_tag_guardianstats\":\"CharacterLinks_link_tag_guardianstats__3_ENi\",\"link_tag_raidreport\":\"CharacterLinks_link_tag_raidreport__3iZyI\",\"link_tag_dungeonreport\":\"CharacterLinks_link_tag_dungeonreport__h6cTw\",\"hide\":\"CharacterLinks_hide__DeOYK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"interPowerBar\":\"InterPowerBar_interPowerBar__2DEuA\",\"min\":\"InterPowerBar_min__3nCmQ\",\"max\":\"InterPowerBar_max__28EWN\",\"bar\":\"InterPowerBar_bar__2lyDu\",\"fillBar\":\"InterPowerBar_fillBar__1ysnF\",\"extraFillBar\":\"InterPowerBar_extraFillBar__3RKOG\",\"barOverlay\":\"InterPowerBar_barOverlay__3DSq0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"anchor\":\"LoadingSpinner_anchor__3ITPU\",\"spinner\":\"LoadingSpinner_spinner__2JmvS\",\"spin\":\"LoadingSpinner_spin__3NTaL\",\"loading\":\"LoadingSpinner_loading__2zmcp\",\"spinnerLarge\":\"LoadingSpinner_spinnerLarge__1yDGo\",\"spinnerLargeDouble\":\"LoadingSpinner_spinnerLargeDouble__1GpRu\",\"spinnerSmall\":\"LoadingSpinner_spinnerSmall__2sJ3H\",\"spinnerSmallDouble\":\"LoadingSpinner_spinnerSmallDouble__avKCz\",\"status\":\"LoadingSpinner_status__1YjPy\"};","export const BUNGIE_OAUTH_AUTHORIZE_URL =\n  \"https://www.bungie.net/en/OAuth/Authorize\";\nexport const BUNGIE_OAUTH_TOKEN_URL =\n  \"https://www.bungie.net/platform/app/oauth/token/\";\n\nconst {\n  REACT_APP_BUNGIE_API_KEY,\n  REACT_APP_BUNGIE_OAUTH_CLIENT_ID,\n  REACT_APP_BUNGIE_OAUTH_CLIENT_SECRET,\n} = process.env;\n\nif (\n  !REACT_APP_BUNGIE_API_KEY ||\n  !REACT_APP_BUNGIE_OAUTH_CLIENT_ID ||\n  !REACT_APP_BUNGIE_OAUTH_CLIENT_SECRET\n) {\n  throw Error(\"React env vars must be provided\");\n}\n\nexport const BUNGIE_API_KEY = REACT_APP_BUNGIE_API_KEY;\nexport const BUNGIE_OAUTH_CLIENT_ID = REACT_APP_BUNGIE_OAUTH_CLIENT_ID;\nexport const BUNGIE_OAUTH_CLIENT_SECRET = REACT_APP_BUNGIE_OAUTH_CLIENT_SECRET;\n","if (process.env.NODE_ENV === \"development\") {\n  console.debug(process.env);\n}\n\nexport const debug = (...messages: any[]) => {\n  if (process.env.NODE_ENV === \"development\") {\n    console.debug(...messages);\n  }\n};\n","import { EventEmitter } from \"events\";\nimport { useEffect, useRef } from \"react\";\nimport { debug } from \"./debug\";\n\nexport enum EVENTS {\n  GET_MANIFEST = \"GET_MANIFEST\",\n  LOAD_MANIFEST_DATA = \"LOAD_MANIFEST_DATA\",\n  FETCH_MANIFEST_DATA = \"FETCH_MANIFEST_DATA\",\n  PARSE_MANIFEST_DATA = \"PARSE_MANIFEST_DATA\",\n  STORE_MANIFEST_DATA = \"STORE_MANIFEST_DATA\",\n  MANIFEST_DATA_READY = \"MANIFEST_DATA_READY\",\n  MANIFEST_FETCH_ERROR = \"MANIFEST_FETCH_ERROR\",\n\n  UNAUTHED_FETCH_ERROR = \"UNAUTHED_FETCH_ERROR\",\n\n  FETCHING_CHARACTER_DATA_CHANGE = \"FETCHING_CHARACTER_DATA_CHANGE\",\n\n  LOG_OUT = \"LOG_OUT\",\n}\n\nconst eventEmitter = new EventEmitter();\n\nexport default eventEmitter;\n\n(() => {\n  const ee = eventEmitter as any;\n  const oldEmit = ee.emit;\n  ee.emit = (...args: any[]) => {\n    debug(args);\n    oldEmit.apply(ee, args);\n  };\n})();\n\ntype EventHandler<T extends any[]> = (args: T) => void;\n\nfunction useEvent<T extends any[]>(\n  eventName: EVENTS,\n  handler: EventHandler<T>\n) {\n  const savedHandler = useRef<EventHandler<T>>();\n\n  useEffect(() => {\n    savedHandler.current = handler;\n  }, [handler]);\n\n  useEffect(() => {\n    const eventListener = (eventData: T) => savedHandler.current?.(eventData);\n    eventEmitter.addListener(eventName, eventListener);\n    return () => {\n      eventEmitter.removeListener(eventName, eventListener);\n    };\n  }, [eventName]);\n}\n\nexport { useEvent };\n","import {\n  DestinyInventoryItemDefinition,\n  DestinyManifest,\n  DestinyRecordDefinition,\n  DestinyVendorDefinition,\n  getDestinyManifest,\n  getProfile,\n  setItemLockState as setItemLockStateApi,\n  DestinyItemStateRequest,\n  DestinyItemCategoryDefinition,\n} from \"bungie-api-ts/destiny2\";\nimport { HttpClientConfig } from \"bungie-api-ts/http\";\nimport { get, set, del } from \"idb-keyval\";\n\nimport { getAccessToken } from \"./bungie-auth\";\nimport { BUNGIE_API_KEY } from \"./config\";\nimport { debug } from \"./debug\";\nimport eventEmitter, { EVENTS } from \"./events\";\nimport ga from \"./ga\";\n\nexport class BungieSystemDisabledError extends Error {\n  constructor() {\n    super(\"Bungie API disabled\");\n  }\n}\n\nexport const bungieAuthedFetch = async (config: HttpClientConfig) => {\n  const accessToken = getAccessToken();\n  const headers: { [key: string]: string } = {\n    \"x-api-key\": BUNGIE_API_KEY,\n  };\n\n  if (accessToken) {\n    headers.Authorization = `Bearer ${accessToken}`;\n  }\n\n  const url = `${config.url}${\n    config.params\n      ? \"?\" +\n        Object.entries(config.params).map(\n          ([key, value]) =>\n            `${encodeURIComponent(key)}=${encodeURIComponent(value as string)}`\n        )\n      : \"\"\n  }`;\n\n  const requestConfig: RequestInit = {\n    method: config.method,\n    headers,\n    credentials: \"include\" as const,\n  };\n\n  if (config.body) {\n    requestConfig.body = JSON.stringify(config.body);\n  }\n\n  const response = await fetch(url, requestConfig);\n  if (response.status !== 200) {\n    if (response.status === 401) {\n      eventEmitter.emit(EVENTS.UNAUTHED_FETCH_ERROR);\n    }\n    if (response.status === 503) {\n      try {\n        const messageData = await response.json();\n        if (messageData && messageData.ErrorStatus === \"SystemDisabled\") {\n          throw new BungieSystemDisabledError();\n        }\n      } catch (e) {\n        /* Do nothing if unrecognised or un-parseable 503 */\n      }\n    }\n    throw Error(response.status.toString());\n  }\n  return await response.json();\n};\n\nconst MANIFEST_VERSION_KEY = \"MANIFEST_VERSION\";\nconst MANIFEST_IDB_KEY = \"MANIFEST_DATA\";\nexport interface ManifestData {\n  [key: string]: any | undefined;\n  DestinyInventoryItemDefinition: {\n    [key: string]: DestinyInventoryItemDefinition | undefined;\n  };\n  DestinyVendorDefinition: {\n    [key: string]: DestinyVendorDefinition | undefined;\n  };\n  DestinyRecordDefinition: {\n    [key: string]: DestinyRecordDefinition | undefined;\n  };\n  DestinyItemCategoryDefinition: {\n    [key: string]: DestinyItemCategoryDefinition | undefined;\n  };\n}\nconst manifestPropertyList = [\n  \"DestinyInventoryItemDefinition\",\n  \"DestinyVendorDefinition\",\n  \"DestinyRecordDefinition\",\n  \"DestinyItemCategoryDefinition\",\n];\n\nlet getCachedManifestDataPromise: Promise<ManifestData> | undefined;\nconst getCachedManifestData = async () => {\n  if (!getCachedManifestDataPromise) {\n    getCachedManifestDataPromise = (async () => {\n      debug(\"Loading manifest data from IDB\");\n      const manifestData = await get(MANIFEST_IDB_KEY);\n      debug(\"Finished loading manifest data from IDB\");\n      return manifestData as ManifestData;\n    })();\n  }\n  return getCachedManifestDataPromise;\n};\n\nconst asBoolean = (value: string) => value && value.toLowerCase() === \"true\";\n\nconst getUserLanguage = () => {\n  const LANG_PATTERN = /^[a-z]{2}$/;\n\n  const queryParams = new URLSearchParams(window.location.search);\n  const queryLang = queryParams.get(\"lang\");\n\n  if (queryLang && LANG_PATTERN.test(queryLang)) {\n    return queryLang;\n  }\n\n  const queryUseUserLang = queryParams.get(\"useLang\") || \"\";\n  const useUserLang = asBoolean(queryUseUserLang);\n\n  if (useUserLang && navigator && navigator.language) {\n    const navLanguage = navigator.language.substr(0, 2);\n    if (LANG_PATTERN.test(navLanguage)) {\n      return navLanguage;\n    }\n  }\n\n  return \"en\";\n};\n\nconst getRemoteManifestData = async (manifest: DestinyManifest) => {\n  debug(\"getRemoteManifestData\");\n  if (!manifest) {\n    throw Error(\"No manifest!\");\n  }\n  const version = manifest.version;\n  eventEmitter.emit(EVENTS.FETCH_MANIFEST_DATA);\n  const language = getUserLanguage();\n  const manifestUrls =\n    manifest.jsonWorldComponentContentPaths[language] ||\n    manifest.jsonWorldComponentContentPaths.en;\n  const manifestDataArray = await Promise.all(\n    manifestPropertyList.map((prop) =>\n      fetch(`https://www.bungie.net${manifestUrls[prop]}`).then((response) =>\n        response.json()\n      )\n    )\n  );\n  const manifestData: ManifestData = manifestPropertyList.reduce(\n    (acc, prop, i) => ({ ...acc, [prop]: manifestDataArray[i] }),\n    {} as any\n  );\n  eventEmitter.emit(EVENTS.STORE_MANIFEST_DATA);\n  await set(MANIFEST_IDB_KEY, manifestData);\n  localStorage.setItem(MANIFEST_VERSION_KEY, `${version}-${language}`);\n  return manifestData;\n};\n\nexport const clearStoredManifest = async () => {\n  // Remove stored data\n  localStorage.removeItem(MANIFEST_VERSION_KEY);\n  await del(MANIFEST_IDB_KEY);\n  // Clear cached manifest promise so it can re-fetch\n  getManifestPromise = undefined;\n  // Trigger re-fetch by emitting error\n  eventEmitter.emit(EVENTS.MANIFEST_FETCH_ERROR);\n};\n\nwindow.clearDestinyManifest = () =>\n  clearStoredManifest().then(() => console.log(\"Cleared Destiny manifest\"));\n\nexport type GetManifestResult =\n  | {\n      manifest: ManifestData;\n      error?: null;\n    }\n  | { manifest: null; error: Error };\n\nlet cachedManifestData: ManifestData | undefined;\nlet getManifestPromise: Promise<GetManifestResult> | undefined;\n\nexport const getManifest = async (): Promise<GetManifestResult> => {\n  debug(\"getManifest\");\n  if (!getManifestPromise) {\n    debug(\"getManifest\", \"create new getManifestPromise\");\n    getManifestPromise = Promise.resolve()\n      .then(async () => {\n        // Start loading cached manifest data early\n        const pendingGetCachedManifestData = getCachedManifestData();\n\n        ga.event({\n          category: \"Data\",\n          action: \"Attempt load manifest\",\n          nonInteraction: true,\n        });\n        eventEmitter.emit(EVENTS.GET_MANIFEST);\n        const manifest = await getDestinyManifest(bungieAuthedFetch);\n        const localStorageManifestVersion = localStorage.getItem(\n          MANIFEST_VERSION_KEY\n        );\n        const language = getUserLanguage();\n        const manifestVersion = `${manifest?.Response?.version}-${language}`;\n        if (\n          manifestVersion &&\n          manifestVersion === localStorageManifestVersion &&\n          !window.location.search.includes(\"updateManifest\")\n        ) {\n          if (!cachedManifestData) {\n            eventEmitter.emit(EVENTS.LOAD_MANIFEST_DATA);\n            cachedManifestData = await pendingGetCachedManifestData;\n          }\n          if (\n            cachedManifestData &&\n            manifestPropertyList.every(\n              (key) => cachedManifestData && !!cachedManifestData[key]\n            )\n          ) {\n            return { manifest: cachedManifestData };\n          }\n        }\n        if (\n          manifest &&\n          manifest.ErrorStatus &&\n          manifest.ErrorStatus !== \"Success\"\n        ) {\n          ga.event({\n            category: \"Errors\",\n            action: `Error status \"${manifest.ErrorStatus}\" returned from manifest request`,\n            nonInteraction: true,\n          });\n          if (manifest.ErrorStatus === \"SystemDisabled\") {\n            return {\n              manifest: null,\n              error: new BungieSystemDisabledError(),\n            };\n          }\n          return {\n            manifest: null,\n            error: Error(\n              `Error status \"${manifest.ErrorStatus}\" returned from manifest request`\n            ),\n          };\n        }\n        if (!manifest || !manifest.Response) {\n          throw Error(\"No manifest received!\");\n        }\n        cachedManifestData = undefined;\n        ga.event({\n          category: \"Data\",\n          action: \"Fetch remote manifest\",\n          nonInteraction: true,\n        });\n        const freshManifestData = await getRemoteManifestData(\n          manifest.Response\n        );\n        cachedManifestData = freshManifestData;\n        return { manifest: freshManifestData };\n      })\n      .then((result) => {\n        if (result.manifest && !result.error) {\n          eventEmitter.emit(EVENTS.MANIFEST_DATA_READY);\n          return result;\n        } else {\n          throw result.error;\n        }\n      })\n      .catch((err) => {\n        console.error(err);\n        // Clear manifest promise so it can be re-fetched\n        eventEmitter.emit(EVENTS.MANIFEST_FETCH_ERROR);\n        getManifestPromise = undefined;\n        return { manifest: null, error: err };\n      });\n  }\n  return getManifestPromise;\n};\n\nexport const getBasicProfile = (\n  membershipType: number,\n  membershipId: string\n) => {\n  debug(\"getBasicProfile\");\n  ga.event({\n    category: \"Character Data\",\n    action: \"Fetch minimal profile\",\n    nonInteraction: true,\n  });\n  return getProfile(bungieAuthedFetch, {\n    components: [\n      200, // DestinyComponentType.Characters,\n      205, // DestinyComponentType.CharacterEquipment,\n    ],\n    destinyMembershipId: membershipId,\n    membershipType,\n  });\n};\n\nexport const getFullProfile = (\n  membershipType: number,\n  membershipId: string\n) => {\n  debug(\"getFullProfile\");\n  ga.event({\n    category: \"Character Data\",\n    action: \"Fetch full profile\",\n    nonInteraction: true,\n  });\n  return getProfile(bungieAuthedFetch, {\n    components: [\n      200, // DestinyComponentType.Characters,\n      201, // DestinyComponentType.CharacterInventories,\n      205, // DestinyComponentType.CharacterEquipment,\n      102, // DestinyComponentType.ProfileInventories,\n      300, // DestinyComponentType.ItemInstances,\n      104, // DestinyComponentType.ProfileProgression\n    ],\n    destinyMembershipId: membershipId,\n    membershipType,\n  });\n};\n\nexport const setItemLockState = (payload: DestinyItemStateRequest) => {\n  debug(\"setItemLockState\");\n  return setItemLockStateApi(bungieAuthedFetch, payload);\n};\n","import ReactGA from \"react-ga\";\n\nconst ENABLED = true;\nlet initialized = false;\n\ninterface AnalyticsInterface {\n  set: (props: { [key: string]: string | boolean }) => void;\n  initialize: (clientId: string, options: { debug?: boolean }) => void;\n  pageview: (url: string) => void;\n  event: (eventProps: {\n    category: string;\n    action: string;\n    label?: string;\n    nonInteraction?: boolean;\n  }) => void;\n}\n\nlet ga: AnalyticsInterface = ReactGA;\n\nexport const init = () => {\n  if (ENABLED && !initialized) {\n    initialized = true;\n    ga.initialize(\"UA-149614480-1\", {\n      // debug: process.env.NODE_ENV === \"development\"\n    });\n\n    // Anonymize IP addresses, yay GDPR\n    ga.set({ anonymizeIp: true });\n    ga.pageview(window.location.pathname + window.location.search);\n  } else {\n    // Set mock GA object to disable without removing other code\n    ga = {\n      initialize: () => undefined,\n      pageview: () => undefined,\n      set: (...args: any[]) => undefined,\n      event: (...args: any[]) => undefined,\n    };\n  }\n};\n\nexport default ga;\n","import { getMembershipDataById, UserInfoCard } from \"bungie-api-ts/user\";\nimport { stringify } from \"simple-query-string\";\n\nimport { bungieAuthedFetch } from \"./bungie-api\";\nimport {\n  BUNGIE_OAUTH_AUTHORIZE_URL,\n  BUNGIE_OAUTH_CLIENT_ID,\n  BUNGIE_OAUTH_CLIENT_SECRET,\n  BUNGIE_OAUTH_TOKEN_URL,\n} from \"./config\";\nimport { debug } from \"./debug\";\nimport eventEmitter, { EVENTS } from \"./events\";\nimport ga from \"./ga\";\n\nconst ACCESS_TOKEN_STORAGE_KEY = \"bungieAccessToken\";\nconst ACCESS_TOKEN_EXPIRY_STORAGE_KEY = \"bungieAccessTokenExpiryTime\";\nconst REFRESH_TOKEN_STORAGE_KEY = \"bungieRefreshToken\";\nconst REFRESH_TOKEN_EXPIRY_STORAGE_KEY = \"bungieRefreshTokenExpiryTime\";\nconst BUNGIE_MEMBERSHIP_ID_STORAGE_KEY = \"bungieMembershipId\";\nconst DESTINY_MEMBERSHIPS_STORAGE_KEY = \"destinyMemberships\";\nconst DESTINY_MEMBERSHIP_STORAGE_KEY = \"destinyMembership\";\nconst MANUAL_AUTHED_STORAGE_KEY = \"manualAuthed\";\n\neventEmitter.on(EVENTS.UNAUTHED_FETCH_ERROR, () => {\n  // If we get 401 from an \"authenticated\" request, assume the access token is invalid\n  debug(\"Clearing invalid access token\");\n  localStorage.removeItem(ACCESS_TOKEN_STORAGE_KEY);\n});\n\nconst clearStorage = () => {\n  debug(\"clearStorage\");\n  localStorage.removeItem(ACCESS_TOKEN_STORAGE_KEY);\n  localStorage.removeItem(ACCESS_TOKEN_EXPIRY_STORAGE_KEY);\n  localStorage.removeItem(REFRESH_TOKEN_STORAGE_KEY);\n  localStorage.removeItem(REFRESH_TOKEN_EXPIRY_STORAGE_KEY);\n  localStorage.removeItem(BUNGIE_MEMBERSHIP_ID_STORAGE_KEY);\n  localStorage.removeItem(DESTINY_MEMBERSHIPS_STORAGE_KEY);\n};\n\nconst clearSelectedMembership = () => {\n  debug(\"clearSelectedMembership\");\n  localStorage.removeItem(DESTINY_MEMBERSHIP_STORAGE_KEY);\n};\n\nexport const hasManuallyAuthed = () => {\n  return !!localStorage.getItem(MANUAL_AUTHED_STORAGE_KEY);\n};\n\nexport const getAuthUrl = () =>\n  `${BUNGIE_OAUTH_AUTHORIZE_URL}?${stringify({\n    response_type: \"code\",\n    client_id: BUNGIE_OAUTH_CLIENT_ID,\n    client_secret: BUNGIE_OAUTH_CLIENT_SECRET,\n  })}`;\n\n// Attempt to prevent infinite navigation events\nlet hasNavigated = false;\nconst redirectToAuth = () => {\n  debug(\"redirectToAuth\");\n  clearStorage();\n  ga.event({\n    category: \"Auth\",\n    action: \"Redirect for Bungie authentication\",\n    nonInteraction: true,\n  });\n  try {\n    if (!hasNavigated) {\n      window.location.assign(getAuthUrl());\n    } else {\n      debug(\"Prevented re-navigation\");\n      throw Error(\"Re-navigation attempt\");\n    }\n    hasNavigated = true;\n  } catch (e) {\n    console.error(e);\n  }\n};\n\nexport const manualStartAuth = () => {\n  debug(\"manualStartAuth\");\n  localStorage.setItem(MANUAL_AUTHED_STORAGE_KEY, \"TRUE\");\n  redirectToAuth();\n};\n\nconst autoSelectDestinyMembership = (destinyMemberships: UserInfoCard[]) => {\n  debug(\"autoSelectMembership\");\n  // If there is only one membership, select it automatically\n  if (destinyMemberships.length === 1) {\n    setSelectedDestinyMembership(destinyMemberships[0]);\n    return destinyMemberships[0];\n  }\n\n  const crossSavePrimaryMemberships = destinyMemberships.filter(\n    (m) => m.crossSaveOverride === m.membershipType\n  );\n  const nonCrossSaveMemberships = destinyMemberships.filter(\n    (m) => m.crossSaveOverride === 0\n  );\n  if (\n    crossSavePrimaryMemberships.length === 1 &&\n    nonCrossSaveMemberships.length === 0\n  ) {\n    setSelectedDestinyMembership(crossSavePrimaryMemberships[0]);\n    return crossSavePrimaryMemberships[0];\n  }\n};\n\nconst handleTokenResponse = async (tokenResponse: Response) => {\n  debug(\"handleTokenResponse\");\n  if (tokenResponse.status === 200) {\n    const data = await tokenResponse.json();\n\n    const accessToken = data.access_token as string;\n    const tokenDuration = data.expires_in as number;\n    const expiryTime = Date.now() + tokenDuration * 1000;\n\n    const refreshToken = data.refresh_token as string;\n    const refreshTokenDuration = data.refresh_expires_in as number;\n    const refreshExpiryTime = Date.now() + refreshTokenDuration * 1000;\n\n    const bungieMembershipId = data.membership_id as string;\n\n    localStorage.setItem(ACCESS_TOKEN_STORAGE_KEY, accessToken);\n    localStorage.setItem(\n      ACCESS_TOKEN_EXPIRY_STORAGE_KEY,\n      expiryTime.toString()\n    );\n    localStorage.setItem(REFRESH_TOKEN_STORAGE_KEY, refreshToken);\n    localStorage.setItem(\n      REFRESH_TOKEN_EXPIRY_STORAGE_KEY,\n      refreshExpiryTime.toString()\n    );\n\n    localStorage.setItem(BUNGIE_MEMBERSHIP_ID_STORAGE_KEY, bungieMembershipId);\n\n    // 254 = all memberships\n    const destinyMembershipsResponse = await getMembershipDataById(\n      bungieAuthedFetch,\n      { membershipId: bungieMembershipId, membershipType: 254 }\n    );\n\n    if (\n      !destinyMembershipsResponse ||\n      !destinyMembershipsResponse.Response ||\n      (destinyMembershipsResponse.ErrorStatus &&\n        destinyMembershipsResponse.ErrorStatus !== \"Success\")\n    ) {\n      ga.event({\n        category: \"Errors\",\n        action: `Destiny membership fetch error, status: ${destinyMembershipsResponse.ErrorStatus}`,\n        nonInteraction: true,\n      });\n      return {\n        authSuccess: false,\n        error: `Status code ${destinyMembershipsResponse.ErrorStatus} from memberships endpoint`,\n      };\n    }\n\n    const destinyMemberships =\n      destinyMembershipsResponse.Response.destinyMemberships;\n    localStorage.setItem(\n      DESTINY_MEMBERSHIPS_STORAGE_KEY,\n      JSON.stringify(destinyMemberships)\n    );\n\n    // If has stored membership and the membership ID is not in the new list\n    // of memberships then clear it\n    const selectedMembership = getSelectedDestinyMembership();\n    if (\n      selectedMembership &&\n      !destinyMemberships.some(\n        (m) => m.membershipId === selectedMembership.membershipId\n      )\n    ) {\n      clearSelectedMembership();\n    }\n\n    autoSelectDestinyMembership(destinyMemberships);\n\n    return { accessToken, authSuccess: true };\n  } else {\n    if (tokenResponse.status !== 200) {\n      ga.event({\n        category: \"Auth\",\n        action: `Status code ${tokenResponse.status} from authentication request`,\n        nonInteraction: true,\n      });\n      return {\n        authSuccess: false,\n        error: `Status code ${tokenResponse.status} from authentication request`,\n      };\n    }\n  }\n};\n\nconst fetchAccessToken = async (authCode: string) => {\n  debug(\"fetchAccessToken\");\n  debug(\"Fetching Bungie API access token for authentication code\");\n  ga.event({\n    category: \"Auth\",\n    action: \"Oauth token request\",\n    nonInteraction: true,\n  });\n  const tokenResponse = await fetch(BUNGIE_OAUTH_TOKEN_URL, {\n    body: stringify({\n      grant_type: \"authorization_code\",\n      code: authCode,\n      client_id: BUNGIE_OAUTH_CLIENT_ID,\n      client_secret: BUNGIE_OAUTH_CLIENT_SECRET,\n    }),\n    cache: \"no-cache\",\n    credentials: \"include\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    },\n    method: \"POST\",\n    redirect: \"follow\",\n    referrer: \"no-referrer\",\n  });\n  return await handleTokenResponse(tokenResponse);\n};\n\nconst refreshAccessToken = async () => {\n  debug(\"refreshAccessToken\");\n  debug(\"Refreshing Bungie API access token\");\n  const refreshToken = localStorage.getItem(REFRESH_TOKEN_STORAGE_KEY);\n  ga.event({\n    category: \"Auth\",\n    action: \"Oauth token refresh\",\n    nonInteraction: true,\n  });\n  const tokenResponse = await fetch(BUNGIE_OAUTH_TOKEN_URL, {\n    body: stringify({\n      grant_type: \"refresh_token\",\n      refresh_token: refreshToken,\n      client_id: BUNGIE_OAUTH_CLIENT_ID,\n      client_secret: BUNGIE_OAUTH_CLIENT_SECRET,\n    }),\n    cache: \"no-cache\",\n    credentials: \"include\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    },\n    method: \"POST\",\n    redirect: \"follow\",\n    referrer: \"no-referrer\",\n  });\n  const handleResult = await handleTokenResponse(tokenResponse);\n  if (!handleResult || !handleResult.authSuccess) {\n    // If refreshing failed, clear all auth details so we don't attempt repeated refreshes\n    clearStorage();\n  }\n  return handleResult;\n};\n\nexport const getAccessToken = () => {\n  debug(\"getAccessToken\");\n  return localStorage.getItem(ACCESS_TOKEN_STORAGE_KEY);\n};\n\nconst hasValidAccessToken = () => {\n  const accessToken = getAccessToken();\n  const accessTokenExpiryTime = parseInt(\n    localStorage.getItem(ACCESS_TOKEN_EXPIRY_STORAGE_KEY) || \"-1\",\n    10\n  );\n\n  return accessToken && accessTokenExpiryTime > Date.now();\n};\n\nconst hasValidRefreshToken = () => {\n  const refreshToken = localStorage.getItem(REFRESH_TOKEN_STORAGE_KEY);\n  const refreshTokenExpiryTime = parseInt(\n    localStorage.getItem(REFRESH_TOKEN_EXPIRY_STORAGE_KEY) || \"-1\",\n    10\n  );\n\n  return refreshToken && refreshTokenExpiryTime > Date.now();\n};\n\nexport const hasValidAuth = () => {\n  const accessTokenIsValid = hasValidAccessToken();\n\n  const bungieMembershipId = localStorage.getItem(\n    BUNGIE_MEMBERSHIP_ID_STORAGE_KEY\n  );\n  const destinyMemberships = getDestinyMemberships();\n  if (!accessTokenIsValid || !bungieMembershipId || !destinyMemberships) {\n    return false;\n  }\n  return true;\n};\n\nexport const getDestinyMemberships = () => {\n  debug(\"getDestinyMemberships\");\n  const destinyMembershipsString = localStorage.getItem(\n    DESTINY_MEMBERSHIPS_STORAGE_KEY\n  );\n  try {\n    if (destinyMembershipsString) {\n      return JSON.parse(destinyMembershipsString) as UserInfoCard[];\n    }\n  } catch (e) {\n    ga.event({\n      category: \"Data\",\n      action: \"Error loading destiny memberships from local storage\",\n      nonInteraction: true,\n    });\n    console.error(`Error loading destiny memberships`, e.message);\n  }\n  return undefined;\n};\n\nexport const hasDestinyMemberships = () => {\n  return !!getDestinyMemberships();\n};\n\nexport const getSelectedDestinyMembership = () => {\n  debug(\"getSelectedDestinyMembership\");\n  const destinyMembershipString = localStorage.getItem(\n    DESTINY_MEMBERSHIP_STORAGE_KEY\n  );\n  try {\n    if (destinyMembershipString) {\n      return JSON.parse(destinyMembershipString) as UserInfoCard;\n    }\n    const memberships = getDestinyMemberships();\n    if (memberships) {\n      const autoSelectedMembership = autoSelectDestinyMembership(memberships);\n      return autoSelectedMembership;\n    }\n  } catch (e) {\n    ga.event({\n      category: \"Data\",\n      action: \"Error loading destiny membership from local storage\",\n      nonInteraction: true,\n    });\n    console.error(\"Error loading destiny membership\", e.message);\n  }\n  return undefined;\n};\n\nexport const hasSelectedDestinyMembership = () => {\n  return !!getSelectedDestinyMembership();\n};\n\nexport const setSelectedDestinyMembership = (membership: UserInfoCard) => {\n  debug(\"setSelectedDestinyMembership\");\n  localStorage.setItem(\n    DESTINY_MEMBERSHIP_STORAGE_KEY,\n    JSON.stringify(membership)\n  );\n};\n\nexport const auth = async (): Promise<boolean> => {\n  debug(\"auth\");\n  const queryParams = new URLSearchParams(window.location.search);\n  const authCode = queryParams.get(\"code\");\n\n  if (authCode && !hasValidAuth()) {\n    debug(\"Fetching access token with auth code\");\n    const authResponse = await fetchAccessToken(authCode);\n    if (authResponse && authResponse?.authSuccess === false) {\n      console.error(authResponse.error);\n      return false;\n    }\n  }\n\n  if (authCode) {\n    window.history.replaceState(\n      {},\n      document.title,\n      `${window.location.origin}${window.location.pathname}`\n    );\n  }\n\n  if (hasValidAuth() && hasDestinyMemberships()) {\n    return true;\n  }\n\n  const isAccessTokenValid = hasValidAccessToken();\n  const isRefreshTokenValid = hasValidRefreshToken();\n\n  if (!isAccessTokenValid && isRefreshTokenValid) {\n    await refreshAccessToken();\n    return auth();\n  }\n\n  if (hasManuallyAuthed()) {\n    debug(\n      \"Redirecting to fresh authentication for missing or expired access token, or missing destiny memberships\"\n    );\n    redirectToAuth();\n  }\n\n  return false;\n};\n\nexport const logOut = async () => {\n  debug(\"logOut\");\n  localStorage.removeItem(MANUAL_AUTHED_STORAGE_KEY);\n  clearStorage();\n  eventEmitter.emit(EVENTS.LOG_OUT);\n};\n","import classnames from \"classnames\";\nimport React, { useState } from \"react\";\n\nimport STYLES from \"./CharacterLinks.module.scss\";\n\ninterface CharacterLinksProps {\n  membershipType: number;\n  membershipId: string;\n  characterId: string;\n  onImageExportClick?: () => Promise<any>;\n}\n\ninterface LinkOptions {\n  text?: string;\n  tags?: string[];\n}\n\n/* eslint-disable react/jsx-no-target-blank */\nconst link = (url: string, { text, tags = [] }: LinkOptions = {}) => {\n  const linkText = text || new URL(url).hostname;\n  return (\n    <li>\n      <a\n        href={url}\n        target=\"_blank\"\n        rel=\"noopener\"\n        className={classnames(...tags.map((tag) => STYLES[`link_tag_${tag}`]))}\n      >\n        <span className={STYLES.linkText}>{linkText}</span>\n      </a>\n    </li>\n  );\n};\n\nconst RAID_AND_DUNGEON_REPORT_PLATFORMS: { [key: number]: string } = {\n  1: \"xb\",\n  2: \"ps\",\n  3: \"pc\",\n  4: \"pc\",\n  5: \"stadia\",\n};\n\nexport const CharacterLinks = ({\n  membershipType,\n  membershipId,\n  characterId,\n  onImageExportClick,\n}: CharacterLinksProps) => {\n  const [isHidden, setHidden] = useState(false);\n\n  return (\n    <div\n      className={classnames(STYLES.characterLinks, { [STYLES.hide]: isHidden })}\n    >\n      <div className={STYLES.content}>\n        <ul>\n          {link(\"https://www.destinyitemmanager.com\", {\n            text: \"Destiny Item Manager\",\n            tags: [\"dim\"],\n          })}\n          {link(\n            `https://braytech.org/${membershipType}/${membershipId}/${characterId}/now`,\n            { text: \"Braytech\", tags: [\"braytech\"] }\n          )}\n          {link(\"https://destinysets.com/\", {\n            text: \"Destiny Sets\",\n            tags: [\"destinysets\"],\n          })}\n          {link(\n            `https://www.d2checklist.com/${membershipType}/${membershipId}/milestones`,\n            { text: \"D2 Checklist\", tags: [\"d2checklist\"] }\n          )}\n          {link(`https://guardianstats.com/profile/${membershipId}`, {\n            text: \"Guardianstats\",\n            tags: [\"guardianstats\"],\n          })}\n          {link(\n            `https://raid.report/${RAID_AND_DUNGEON_REPORT_PLATFORMS[membershipType]}/${membershipId}`,\n            { text: \"Raid Report\", tags: [\"raidreport\"] }\n          )}\n          {link(\n            `https://dungeon.report/${RAID_AND_DUNGEON_REPORT_PLATFORMS[membershipType]}/${membershipId}`,\n            { text: \"Dungeon Report\", tags: [\"dungeonreport\"] }\n          )}\n          {onImageExportClick && (\n            <li>\n              <span\n                className={STYLES.link}\n                onClick={async () => {\n                  setHidden(true);\n                  await onImageExportClick();\n                  setHidden(false);\n                }}\n              >\n                <span className={STYLES.linkText}>Export image</span>\n              </span>\n            </li>\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n};\n","export const ITEM_SLOT_KINETIC = \"kinetic\";\nexport const ITEM_SLOT_ENERGY = \"energy\";\nexport const ITEM_SLOT_POWER = \"power\";\nexport const ITEM_SLOT_HEAD = \"head\";\nexport const ITEM_SLOT_GLOVES = \"gloves\";\nexport const ITEM_SLOT_CHEST = \"chest\";\nexport const ITEM_SLOT_LEGS = \"legs\";\nexport const ITEM_SLOT_CLASS_ITEM = \"classItem\";\n\nexport const ITEM_SLOT_BUCKETS = {\n  [ITEM_SLOT_KINETIC]: 1498876634,\n  [ITEM_SLOT_ENERGY]: 2465295065,\n  [ITEM_SLOT_POWER]: 953998645,\n  [ITEM_SLOT_HEAD]: 3448274439,\n  [ITEM_SLOT_GLOVES]: 3551918588,\n  [ITEM_SLOT_CHEST]: 14239492,\n  [ITEM_SLOT_LEGS]: 20886954,\n  [ITEM_SLOT_CLASS_ITEM]: 1585787867,\n};\n\nexport const ITEM_BUCKET_SLOTS = Object.entries(ITEM_SLOT_BUCKETS).reduce(\n  (buckets, [slot, bucket]) => ({ ...buckets, [bucket]: slot }),\n  {} as { [bucket: number]: string }\n);\n\nexport const ITEM_SLOT_GROUP_WEAPONS = [\n  ITEM_SLOT_KINETIC,\n  ITEM_SLOT_ENERGY,\n  ITEM_SLOT_POWER,\n];\nexport const ITEM_SLOT_GROUP_ARMOR = [\n  ITEM_SLOT_HEAD,\n  ITEM_SLOT_GLOVES,\n  ITEM_SLOT_CHEST,\n  ITEM_SLOT_LEGS,\n  ITEM_SLOT_CLASS_ITEM,\n];\n\nexport const ORDERED_ITEM_SLOTS = [\n  ...ITEM_SLOT_GROUP_WEAPONS,\n  ...ITEM_SLOT_GROUP_ARMOR,\n];\n\nexport const ITEM_TIER_TYPE_EXOTIC = 6;\n\nexport const ITEM_TYPE_ARMOR = 2;\nexport const ITEM_TYPE_WEAPON = 3;\n\nexport const CLASS_TYPE_ALL = 3;\n\nexport const CLASS_TITAN = \"titan\";\nexport const CLASS_HUNTER = \"hunter\";\nexport const CLASS_WARLOCK = \"warlock\";\n\nexport const CLASS_NAMES = [CLASS_TITAN, CLASS_HUNTER, CLASS_WARLOCK];\n\nexport const ITEM_TYPE_ARTIFACT = 28;\nexport const ARTIFACT_INVENTORY_BUCKET_HASH = 1506418338;\n\nexport const POWER_SYMBOL = \"✧\";\nexport const BUNGIE_POWER_COLOR = \"#DDCB59\";\nexport const BUNGIE_COLOUR_SOLAR = \"ef621d\";\nexport const BUNGIE_COLOUR_ARC = \"7abce9\";\nexport const BUNGIE_COLOUR_VOID = \"b085df\";\n\nexport const ITEM_POWER_SOFT_CAP = 1250;\nexport const ITEM_POWER_POWERFUL_CAP = 1300;\nexport const ITEM_POWER_PINNACLE_CAP = 1310;\n\n// How much above your current power do pinnacles drop when above the powerful cap\nexport const ITEM_POWER_PINNACLE_DROP_OFFSET_WEAK = 1;\nexport const ITEM_POWER_PINNACLE_DROP_OFFSET = 2;\n","import { SelectedJoinedItemDefinition } from \"../types\";\n\n// From destiny-api-ts ItemState.Masterwork\nconst ITEM_STATE_MASTERWORK = 4;\n\nexport const isMasterwork = (item: SelectedJoinedItemDefinition) => {\n  // tslint:disable-next-line:no-bitwise\n  if (item.state && item.state & ITEM_STATE_MASTERWORK) {\n    return true;\n  }\n\n  return false;\n};\n","import { ItemLocation } from \"bungie-api-ts/destiny2\";\nimport classnames from \"classnames\";\nimport React from \"react\";\n\nimport STYLES from \"./PowerBar.module.scss\";\n\ninterface BarProps {\n  min: number;\n  max: number;\n  value: number;\n  avgValue: number;\n  label: string;\n  icon?: string;\n  isMasterworked?: boolean;\n  itemName?: string;\n  itemType?: string;\n  location?: ItemLocation;\n  isEquipped?: boolean;\n}\n\nconst getLocationLabel = (location?: ItemLocation, isEquipped?: boolean) => {\n  switch (location) {\n    case 0: // ItemLocation.Unknown:\n      return undefined;\n    case 1: // ItemLocation.Inventory:\n      if (isEquipped) {\n        return \"Equipped\";\n      }\n      return \"Inventory\";\n    case 2: // ItemLocation.Vault:\n      return \"Vault\";\n    case 3: //ItemLocation.Vendor:\n      return \"Vendor\";\n    case 4: //ItemLocation.Postmaster:\n      return \"Postmaster\";\n    default:\n      return undefined;\n  }\n};\n\nexport const PowerBar = ({\n  min,\n  max,\n  value,\n  avgValue,\n  label,\n  icon,\n  isMasterworked,\n  itemName,\n  itemType,\n  location,\n  isEquipped,\n}: BarProps) => {\n  const range = max - min;\n  const perc = Math.floor(((value - min) / range) * 1000) / 10;\n  const avgPerc = Math.floor(((avgValue - min) / range) * 1000) / 10;\n  // const plusTwoPerc = Math.floor(((avgValue + 2 - min) / range) * 1000) / 10\n  // const plusFivePerc = Math.floor(((avgValue + 5 - min) / range) * 1000) / 10\n  const fullLabelText = `${value} ${label}`;\n\n  const locationLabel = getLocationLabel(location, isEquipped);\n  const specificItemLabel = `${itemName}${\n    locationLabel ? ` (${locationLabel})` : \"\"\n  }`;\n  const fullLabel = (\n    <span className={STYLES.label}>\n      <span\n        className={classnames(STYLES.power, {\n          [STYLES.max]: value >= max,\n          [STYLES.belowAverage]: value < avgValue,\n        })}\n      >\n        {value}\n      </span>\n      <span className={STYLES.slotName}>\n        <span className={STYLES.generalLabel}>{itemType}</span>\n        <span className={STYLES.specificLabel}>{specificItemLabel}</span>\n      </span>\n    </span>\n  );\n  return (\n    <div className={STYLES.barWrapper}>\n      <div className={STYLES.iconWrapper} title={specificItemLabel}>\n        {icon ? (\n          <img\n            className={STYLES.icon}\n            src={`https://www.bungie.net${icon}`}\n            alt={fullLabelText}\n          />\n        ) : null}\n        {icon && location === 2 /*ItemLocation.Vault*/ ? (\n          <div className={STYLES.vaultOverlay} />\n        ) : null}\n        {icon && location === 4 /*ItemLocation.Postmaster*/ ? (\n          <div className={STYLES.postmasterOverlay} />\n        ) : null}\n        {icon && isMasterworked ? (\n          <div className={STYLES.masterworkOverlay} />\n        ) : null}\n      </div>\n      <div className={STYLES.barContainer}>\n        <div className={STYLES.filledBar} style={{ width: `${perc}%` }}>\n          {fullLabel}\n        </div>\n        <div className={STYLES.barLine} style={{ left: `${avgPerc}%` }} />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { ITEM_POWER_POWERFUL_CAP, ORDERED_ITEM_SLOTS } from \"../../constants\";\nimport { isMasterwork } from \"../../services/masterwork\";\nimport { PowerBarsCharacterData, PowerBySlot } from \"../../types\";\nimport { PowerBar } from \"./PowerBar\";\nimport STYLES from \"./PowerBars.module.scss\";\n\nconst classItemNames: { [key: string]: string } = {\n  hunter: \"Hunter Cloak\",\n  titan: \"Titan Mark\",\n  warlock: \"Warlock Bond\",\n};\nconst slotFullNames = (className: string): { [key: string]: string } => ({\n  chest: \"Chest Armor\",\n  classItem: classItemNames[className],\n  energy: \"Energy Weapon\",\n  gloves: \"Gauntlets\",\n  head: \"Helmet\",\n  kinetic: \"Kinetic Weapon\",\n  legs: \"Leg Armor\",\n  power: \"Power Weapon\",\n});\n\ntype PowerBarsProps = PowerBarsCharacterData & {\n  useUnrestrictedPower?: boolean;\n};\n\nexport const PowerBars = (data: PowerBarsProps) => {\n  const itemsBySlot =\n    data.useUnrestrictedPower &&\n    data.unrestrictedOverallPowerExact &&\n    data.unrestrictedOverallPowerExact > data.overallPowerExact\n      ? data.topUnrestrictedItemBySlot\n      : data.topItemBySlot;\n\n  // Get power by slot, using overall power if slot data does not exist\n  const powerBySlot = ORDERED_ITEM_SLOTS.reduce(\n    (slots, slotName) => ({\n      ...slots,\n      [slotName]:\n        itemsBySlot?.[slotName]?.instanceData?.primaryStat?.value ||\n        data.overallPower,\n    }),\n    {} as PowerBySlot\n  );\n\n  const roundedPower = Math.floor(data.overallPower);\n  // Round to 50s\n  const minItemPower = Math.min(...Object.values(powerBySlot));\n  const minPowerToDisplay = Math.max(\n    Math.floor(minItemPower / 50) * 50 - 50,\n    0\n  );\n  const maxItemPower = Math.max(...Object.values(powerBySlot));\n  const maxItemPowerGrouping =\n    ITEM_POWER_POWERFUL_CAP - maxItemPower < 50 ? 10 : 50;\n  const maxPowerToDisplay =\n    Math.ceil(maxItemPower / maxItemPowerGrouping) * maxItemPowerGrouping;\n\n  const range = maxPowerToDisplay - minPowerToDisplay;\n  const perc =\n    Math.floor(((roundedPower - minPowerToDisplay) / range) * 1000) / 10;\n\n  return (\n    <div className={STYLES.powerBars}>\n      <div className={STYLES.powerRange}>\n        <div className={STYLES.minPower}>{minPowerToDisplay}</div>\n        <div className={STYLES.rangeLine} />\n        <div className={STYLES.maxPower}>{maxPowerToDisplay}</div>\n      </div>\n      <div className={STYLES.bars}>\n        {Object.entries(powerBySlot).map(([slotName, power]) => {\n          const bestItem = itemsBySlot?.[slotName];\n          return (\n            <PowerBar\n              key={`${data.character.characterId}_${slotName}`}\n              min={minPowerToDisplay}\n              max={maxPowerToDisplay}\n              value={power}\n              avgValue={roundedPower}\n              label={slotFullNames(data.className)[slotName] || slotName}\n              icon={bestItem?.itemDefinition?.displayProperties.icon}\n              isMasterworked={bestItem && isMasterwork(bestItem)}\n              itemName={bestItem?.itemDefinition?.displayProperties.name}\n              itemType={\n                (bestItem?.itemCategories?.[0]?.parentCategoryHashes?.[0] ===\n                  1 &&\n                  bestItem?.itemCategories?.[0]?.displayProperties.name) ||\n                bestItem?.itemDefinition?.itemTypeDisplayName\n              }\n              location={bestItem?.location}\n              isEquipped={bestItem?.instanceData?.isEquipped}\n            />\n          );\n        })}\n      </div>\n      <div className={STYLES.powerLabel}>\n        <div className={STYLES.indicator} style={{ left: `${perc}%` }}>\n          {roundedPower}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { ITEM_POWER_PINNACLE_CAP } from \"../../constants\";\nimport STYLES from \"./InterPowerBar.module.scss\";\n\ninterface InterPowerBarProps {\n  value: number;\n  extraValue?: number;\n}\n\nexport const InterPowerBar = ({ value, extraValue }: InterPowerBarProps) => {\n  const valueToUse = extraValue && extraValue > value ? extraValue : value;\n\n  let min = Math.floor(valueToUse);\n  let max = valueToUse === min ? valueToUse + 1 : Math.ceil(valueToUse);\n\n  if (min === ITEM_POWER_PINNACLE_CAP && valueToUse === min) {\n    max = min;\n    min = min - 1;\n  }\n\n  const fillPerc = Math.max(0, Math.floor(value * 100 - min * 100));\n  const extraFillPerc = extraValue\n    ? Math.floor(extraValue * 100 - min * 100)\n    : undefined;\n\n  return (\n    <div className={STYLES.interPowerBar}>\n      <div className={STYLES.min}>{min}</div>\n      <div className={STYLES.bar}>\n        {extraValue ? (\n          <div\n            className={STYLES.extraFillBar}\n            style={{ width: `${extraFillPerc}%` }}\n          />\n        ) : null}\n        <div className={STYLES.fillBar} style={{ width: `${fillPerc}%` }} />\n        <div className={STYLES.barOverlay} />\n      </div>\n      <div className={STYLES.max}>{max}</div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport STYLES from \"./Power.module.scss\";\n\nconst numberWithSign = (value: number) => {\n  if (value >= 0) {\n    return `+${value}`;\n  }\n  return `${value}`;\n};\n\ninterface PowerProps {\n  children: number;\n  withSign?: boolean;\n}\nexport const Power = ({ children: value, withSign = false }: PowerProps) => (\n  <span className={STYLES.inlinePowerNumber}>\n    {withSign ? numberWithSign(value) : value}\n  </span>\n);\n","import React from \"react\";\n\nimport STYLES from \"./PowerDetails.module.scss\";\n\nimport { InterPowerBar } from \"./InterPowerBar\";\nimport { Power } from \"./Power\";\n\nconst ProgressBar = ({ value, max }: { value: number; max: number }) => {\n  if (value === undefined || max === undefined) {\n    return null;\n  }\n  const perc = Math.floor((value / max) * 1000) / 10;\n  const withThousands = (n: number) =>\n    n.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  return (\n    <div\n      className={STYLES.progressBar}\n      title={`${withThousands(value)} / ${withThousands(max)}`}\n    >\n      <div className={STYLES.progressBarFill} style={{ width: `${perc}%` }} />\n      <div className={STYLES.progressBarOverlay} />\n    </div>\n  );\n};\n\ninterface PowerDetailsProps {\n  overallPowerExact: number;\n  overallPower: number;\n  artifactData?: {\n    name: string;\n    iconPath: string;\n    bonusPower: number;\n    progressToNextLevel: number;\n    nextLevelAt: number;\n  };\n  unrestrictedOverallPower?: number;\n  unrestrictedOverallPowerExact?: number;\n  useUnrestrictedPower?: boolean;\n}\n\nexport const PowerDetails = ({\n  overallPowerExact,\n  overallPower,\n  artifactData,\n  unrestrictedOverallPower,\n  unrestrictedOverallPowerExact,\n  useUnrestrictedPower = true,\n}: PowerDetailsProps) => {\n  const powerToDisplay =\n    (useUnrestrictedPower && unrestrictedOverallPower) || overallPower;\n\n  if (!artifactData || artifactData.bonusPower === 0) {\n    return (\n      <div className={STYLES.details}>\n        <div className={STYLES.detailsRow}>\n          <InterPowerBar value={overallPowerExact} />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={STYLES.details}>\n      <div className={STYLES.detailsRow}>\n        <div className={STYLES.detailsLabel}>\n          {useUnrestrictedPower &&\n          unrestrictedOverallPower &&\n          unrestrictedOverallPower > overallPower\n            ? \"Maximum gear power (with exotics)\"\n            : \"Maximum equippable gear power\"}\n          :\n        </div>\n        <div className={STYLES.detailsValue}>\n          <Power>{powerToDisplay}</Power>\n        </div>\n      </div>\n      <div className={STYLES.detailsRow}>\n        <InterPowerBar\n          value={overallPowerExact}\n          extraValue={\n            useUnrestrictedPower ? unrestrictedOverallPowerExact : undefined\n          }\n        />\n      </div>\n      {artifactData ? (\n        <>\n          <div className={STYLES.detailsRow}>\n            <div className={STYLES.detailsLabel}>\n              <img\n                className={STYLES.detailsInlineIcon}\n                src={`https://www.bungie.net${artifactData.iconPath}`}\n                alt=\"\"\n              />\n              {artifactData.name} bonus power:\n            </div>\n            <div className={STYLES.detailsValue}>\n              <Power withSign>{artifactData.bonusPower}</Power>\n            </div>\n          </div>\n          <div className={STYLES.detailsRow}>\n            <ProgressBar\n              value={artifactData.progressToNextLevel}\n              max={artifactData.nextLevelAt}\n            />\n          </div>\n        </>\n      ) : null}\n    </div>\n  );\n};\n","import classnames from \"classnames\";\nimport React from \"react\";\n\nimport {\n  ITEM_POWER_PINNACLE_CAP,\n  ITEM_POWER_PINNACLE_DROP_OFFSET,\n  ITEM_POWER_PINNACLE_DROP_OFFSET_WEAK,\n  ITEM_POWER_POWERFUL_CAP,\n  ITEM_POWER_SOFT_CAP,\n} from \"../../constants\";\nimport { Power } from \"./Power\";\n\nimport STYLES from \"./PowerHints.module.scss\";\n\ninterface PowerHintsProps {\n  overallPowerExact: number;\n  overallPower: number;\n  unrestrictedOverallPowerExact?: number;\n  unrestrictedOverallPower?: number;\n  potentialOverallPower?: number;\n  useUnrestrictedPower?: boolean;\n  onChangeUseUnrestrictedPower?: (newValue: boolean) => void;\n}\n\nexport const PowerHints = ({\n  overallPowerExact,\n  overallPower,\n  unrestrictedOverallPowerExact,\n  unrestrictedOverallPower,\n  potentialOverallPower,\n\n  useUnrestrictedPower = true,\n  onChangeUseUnrestrictedPower = () => {},\n}: PowerHintsProps) => {\n  const powerToUseExact = unrestrictedOverallPowerExact || overallPowerExact;\n  const powerToUse = unrestrictedOverallPower || overallPower;\n\n  potentialOverallPower =\n    potentialOverallPower || Math.min(ITEM_POWER_SOFT_CAP, powerToUse);\n\n  const nextPower =\n    powerToUseExact === powerToUse\n      ? powerToUse + 1\n      : Math.ceil(powerToUseExact);\n\n  const powerRequiredToReachNext = (nextPower - powerToUseExact) * 8;\n  const powerRequiredToReachPotential =\n    (potentialOverallPower - powerToUseExact) * 8;\n\n  const pinnacleDropPowerDisplay =\n    ITEM_POWER_PINNACLE_CAP - powerToUse >\n    ITEM_POWER_PINNACLE_DROP_OFFSET_WEAK ? (\n      <>\n        <Power>\n          {Math.min(\n            powerToUse + ITEM_POWER_PINNACLE_DROP_OFFSET_WEAK,\n            ITEM_POWER_PINNACLE_CAP\n          )}\n        </Power>{\" \"}\n        or{\" \"}\n        <Power>\n          {Math.min(\n            powerToUse + ITEM_POWER_PINNACLE_DROP_OFFSET,\n            ITEM_POWER_PINNACLE_CAP\n          )}\n        </Power>\n      </>\n    ) : (\n      <Power>\n        {Math.min(\n          powerToUse + ITEM_POWER_PINNACLE_DROP_OFFSET,\n          ITEM_POWER_PINNACLE_CAP\n        )}\n      </Power>\n    );\n\n  return (\n    <div className={STYLES.hints}>\n      {potentialOverallPower &&\n        potentialOverallPower > powerToUse &&\n        powerToUse > ITEM_POWER_POWERFUL_CAP && (\n          <div\n            className={classnames(\n              STYLES.hint,\n              STYLES.dropHint,\n              STYLES.legendaryWorldDropHint\n            )}\n          >\n            <span>\n              Powerful rewards can increase your overall gear power to{\" \"}\n              <Power>{potentialOverallPower}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  Powerful rewards from milestones or prime engrams can drop\n                  with a power level up to <Power>{powerToUse}</Power> for this\n                  character.\n                </div>\n                <div>\n                  Replacing items which are below your current overall power can\n                  increase your power to a higher average.\n                </div>\n                {powerToUse < ITEM_POWER_PINNACLE_CAP && (\n                  <div>\n                    Raising your overall power before collecting your next\n                    pinnacle reward will give you the most efficient progress.\n                  </div>\n                )}\n                {powerRequiredToReachNext &&\n                  powerRequiredToReachNext !==\n                    powerRequiredToReachPotential && (\n                    <div>\n                      You need an extra{\" \"}\n                      <Power>{powerRequiredToReachNext}</Power> total power on\n                      your items to reach an overall power of{\" \"}\n                      <Power>{Math.floor(powerToUse + 1)}</Power>.\n                    </div>\n                  )}\n                {powerRequiredToReachPotential && (\n                  <div>\n                    You need an extra{\" \"}\n                    <Power>{powerRequiredToReachPotential}</Power> total power\n                    on your items to reach an overall power of{\" \"}\n                    <Power>{potentialOverallPower}</Power>.\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n      {potentialOverallPower > powerToUse &&\n        powerToUse <= ITEM_POWER_POWERFUL_CAP && (\n          <div\n            className={classnames(\n              STYLES.hint,\n              STYLES.dropHint,\n              STYLES.worldDropHint\n            )}\n          >\n            <span>\n              World drops can increase your overall gear power to{\" \"}\n              <Power>{potentialOverallPower}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  World drops (from strikes, public events,{\" \"}\n                  {powerToUse <= ITEM_POWER_POWERFUL_CAP && \"vendors, \"}\n                  non-powerful rewards) can drop with a power level{\" \"}\n                  {powerToUse >= ITEM_POWER_SOFT_CAP ? (\n                    <>\n                      from <Power>{powerToUse - 3}</Power> to{\" \"}\n                      <Power>{powerToUse}</Power>\n                    </>\n                  ) : (\n                    <>\n                      above your current power, increasing your power\n                      incrementally up to <Power>{potentialOverallPower}</Power>\n                    </>\n                  )}{\" \"}\n                  for this character.\n                </div>\n                <div>\n                  Replacing items which are below your current overall power can\n                  increase your power to a higher average.\n                </div>\n                {powerRequiredToReachNext &&\n                  powerRequiredToReachNext !==\n                    powerRequiredToReachPotential && (\n                    <div>\n                      You need an extra{\" \"}\n                      <Power>{powerRequiredToReachNext}</Power> total power on\n                      your items to reach an overall power of{\" \"}\n                      <Power>{Math.floor(powerToUse + 1)}</Power>.\n                    </div>\n                  )}\n                {powerRequiredToReachPotential && (\n                  <div>\n                    You need an extra{\" \"}\n                    <Power>{powerRequiredToReachPotential}</Power> total power\n                    on your items to reach an overall power of{\" \"}\n                    <Power>{potentialOverallPower}</Power>.\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n      {potentialOverallPower === powerToUse &&\n        powerToUse >= ITEM_POWER_SOFT_CAP &&\n        powerToUse < ITEM_POWER_POWERFUL_CAP && (\n          <div\n            className={classnames(\n              STYLES.hint,\n              STYLES.dropHint,\n              STYLES.powerfulHint\n            )}\n          >\n            <span>\n              Powerful rewards can increase your overall gear power up to the\n              powerful cap of <Power>{ITEM_POWER_POWERFUL_CAP}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  Powerful and pinnacle reward sources (Weekly challenges, Year\n                  4 raids) will give you items above your overall gear power,\n                  with powerful rewards capped at{\" \"}\n                  <Power>{ITEM_POWER_POWERFUL_CAP}</Power>.\n                </div>\n                {powerRequiredToReachNext && (\n                  <div>\n                    You need an extra <Power>{powerRequiredToReachNext}</Power>{\" \"}\n                    total power on your items to reach an overall power of{\" \"}\n                    <Power>{Math.floor(powerToUse + 1)}</Power>.\n                  </div>\n                )}\n                <div>\n                  After getting a powerful reward, check back here to see if\n                  it's beneficial to catch up the rest of your slots with world\n                  drops before getting another!\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n      {potentialOverallPower === powerToUse &&\n        powerToUse >= ITEM_POWER_POWERFUL_CAP &&\n        powerToUse < ITEM_POWER_PINNACLE_CAP && (\n          <div\n            className={classnames(\n              STYLES.hint,\n              STYLES.dropHint,\n              STYLES.pinnacleHint\n            )}\n          >\n            <span>\n              Pinnacle rewards can increase your overall gear power up to the\n              pinnacle cap of <Power>{ITEM_POWER_PINNACLE_CAP}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  Pinnacle reward sources (Some weekly challenges, Year 4 raids)\n                  will give you items at {pinnacleDropPowerDisplay} power.\n                </div>\n                {powerRequiredToReachNext && (\n                  <div>\n                    You need an extra <Power>{powerRequiredToReachNext}</Power>{\" \"}\n                    total power on your items to reach an overall power of{\" \"}\n                    <Power>{Math.floor(powerToUse + 1)}</Power>.\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n\n      {unrestrictedOverallPowerExact &&\n      unrestrictedOverallPowerExact > overallPowerExact ? (\n        <label className={STYLES.toggleCheckbox}>\n          Include multiple exotics\n          <input\n            type=\"checkbox\"\n            checked={useUnrestrictedPower}\n            onClick={() => onChangeUseUnrestrictedPower(!useUnrestrictedPower)}\n          />\n          <span className={STYLES.switch} />\n        </label>\n      ) : null}\n    </div>\n  );\n};\n","import classnames from \"classnames\";\nimport React, { useRef, useState } from \"react\";\n\nimport { PowerBarsCharacterData } from \"../types\";\nimport STYLES from \"./CharacterDisplay.module.scss\";\nimport { CharacterLinks } from \"./characterDisplay/CharacterLinks\";\nimport { PowerBars } from \"./characterDisplay/PowerBars\";\nimport { PowerDetails } from \"./characterDisplay/PowerDetails\";\nimport { PowerHints } from \"./characterDisplay/PowerHints\";\n\nconst titleCase = (text: string) =>\n  text.substr(0, 1).toUpperCase() + text.substr(1);\n\nconst BLACK_RGB = { red: 0, green: 0, blue: 0 };\nconst FALLBACK_EMBLEM_RGB = { red: 0, green: 4, blue: 15 };\nconst FALLBACK_EMBLEM_PATH =\n  \"/common/destiny2_content/icons/9dc4f3283ee9f9fc3d3499e9f9f1756c.jpg\";\n\nconst HAKKE_EMBLEM_RGB = { red: 22, green: 20, blue: 13 };\nconst HAKKE_EMBLEM_PATH =\n  \"/common/destiny2_content/icons/9dd722203e4e69993dc89dca330fb7df.jpg\";\n\nconst rgbString = ({\n  red,\n  green,\n  blue,\n}: {\n  red: number;\n  green: number;\n  blue: number;\n} = BLACK_RGB) => `rgb(${red},${green},${blue})`;\n\nconst useRenderElementImage = (className: string) => {\n  const elementRef = useRef(null);\n  const renderElementImage = async () => {\n    if (elementRef.current) {\n      try {\n        const domToImage = (await import(\n          /* webpackChunkName: \"dom-to-image\" */ \"dom-to-image\"\n        )) as any;\n        const { saveAs } = await import(\n          /* webpackChunkName: \"file-saver\" */ \"file-saver\"\n        );\n        const blob = await domToImage.toBlob(elementRef.current);\n        saveAs(blob, `destiny-power-bars-${className}.png`);\n      } catch (e) {\n        console.error(\"Error capturing image of character display\", e);\n      }\n    }\n  };\n  return [elementRef, renderElementImage] as const;\n};\n\nexport const CharacterDisplayBodyWrapper = (\n  backgroundColor: string,\n  children: JSX.Element,\n  ref?: React.MutableRefObject<null>,\n  onDragStart?: () => void,\n  onDragEnd?: () => void,\n  onDragDrop?: () => void\n) => {\n  const [isDragging, setIsDragging] = useState(false);\n  const [isDraggingOver, setIsDraggingOver] = useState(0);\n\n  return (\n    <div\n      className={classnames(STYLES.characterDisplayWrapper, {\n        [STYLES.dragging]: isDragging,\n        [STYLES.dragOver]: isDraggingOver > 0,\n      })}\n      style={{ backgroundColor }}\n      onDragStart={() => {\n        setIsDragging(true);\n        onDragStart?.();\n      }}\n      onDragEnd={() => {\n        setIsDragging(false);\n        onDragEnd?.();\n      }}\n      onDragEnter={() => setIsDraggingOver(isDraggingOver + 1)}\n      onDragOver={(e) => {\n        e.stopPropagation();\n        e.preventDefault();\n      }}\n      onDragLeave={() => setIsDraggingOver(Math.max(isDraggingOver - 1, 0))}\n      onDrop={() => {\n        setIsDraggingOver(0);\n        onDragDrop?.();\n      }}\n      draggable={true}\n      ref={ref}\n    >\n      {children}\n      <div className={STYLES.dragOverlay}>\n        <span>Drag to reorder</span>\n      </div>\n    </div>\n  );\n};\n\ninterface CharacterDisplayProps {\n  data: PowerBarsCharacterData;\n  onDragStart?: () => void;\n  onDragEnd?: () => void;\n  onDragDrop?: () => void;\n  addClasses?: string[];\n}\n\nconst CharacterDisplay = ({\n  data,\n  onDragStart,\n  onDragEnd,\n  onDragDrop,\n  addClasses = [],\n}: CharacterDisplayProps) => {\n  const [elementRef, renderImage] = useRenderElementImage(data.className);\n\n  const [useUnrestrictedPower, setUseUnrestrictedPower] = useState(true);\n\n  const roundedPower =\n    useUnrestrictedPower && data.unrestrictedOverallPower\n      ? data.unrestrictedOverallPower\n      : data.overallPower;\n\n  const summableArtifactBonusPower = data.artifactData\n    ? data.artifactData.bonusPower\n    : 0;\n\n  return CharacterDisplayBodyWrapper(\n    rgbString(HAKKE_EMBLEM_RGB || data.character.emblemColor || FALLBACK_EMBLEM_RGB),\n    <div className={classnames(STYLES.characterDisplay, ...addClasses)}>\n      <div className={STYLES.header}>\n        <img\n          className={STYLES.emblemBackground}\n          src={`https://www.bungie.net${\n            HAKKE_EMBLEM_PATH || data.character.emblemBackgroundPath || FALLBACK_EMBLEM_PATH\n          }`}\n          alt=\"\"\n        />\n        <div\n          className={classnames(STYLES.name, {\n            [STYLES.withTitle]: !!data.title,\n          })}\n        >\n          {titleCase(data.className)}\n        </div>\n        {data.title && <div className={STYLES.title}>{data.title}</div>}\n        <div\n          className={classnames(STYLES.power, {\n            [STYLES.hasRedacted]: !!data.hasRedactedEquippableItems,\n          })}\n        >\n          {roundedPower + summableArtifactBonusPower}\n        </div>\n        <div className={STYLES.headerOverlayBar} />\n      </div>\n\n      <div className={STYLES.content}>\n        <PowerDetails {...data} useUnrestrictedPower={useUnrestrictedPower} />\n        <PowerBars {...data} useUnrestrictedPower={useUnrestrictedPower} />\n        <PowerHints\n          {...data}\n          useUnrestrictedPower={useUnrestrictedPower}\n          onChangeUseUnrestrictedPower={(newValue) =>\n            setUseUnrestrictedPower(newValue)\n          }\n        />\n      </div>\n\n      <CharacterLinks\n        membershipType={data.character.membershipType}\n        membershipId={data.character.membershipId}\n        characterId={data.character.characterId}\n        onImageExportClick={renderImage}\n      />\n    </div>,\n    elementRef,\n    onDragStart,\n    onDragEnd,\n    onDragDrop\n  );\n};\n\nexport default CharacterDisplay;\n","import FetchSpinner from \"./FetchSpinner\";\n\nexport default FetchSpinner;\n","import React from \"react\";\n\nimport STYLES from \"./FetchSpinner.module.scss\";\n\nconst FetchSpinner = () => (\n  <div className={STYLES.fetchSpinnerContainer}>\n    <div className={STYLES.anchor}>\n      <div className={STYLES.spinner} />\n      <div className={STYLES.spinnerSmall} />\n    </div>\n  </div>\n);\n\nexport default FetchSpinner;\n","import preval from \"preval.macro\";\nimport React from \"react\";\n\nimport STYLES from \"./BuildStamp.module.scss\";\n\nconst gitHead = (process.env.REACT_APP_NPM_PACKAGE_GITHEAD || \"\").substr(0, 6);\n\nconst buildTimestamp = preval`module.exports = new Date().toISOString();`;\n\nconst BuildStamp = () => (\n  <div className={STYLES.buildStamp}>\n    {gitHead} {buildTimestamp}\n  </div>\n);\n\nexport default BuildStamp;\n","import BuildStamp from \"./BuildStamp\";\n\nexport default BuildStamp;\n","import KoFi from \"./KoFi\";\n\nexport default KoFi;\n","import React from \"react\";\n\nimport kofiIcon from \"../../images/icons/Ko-fi_Icon_RGBforDarkBg_sm.png\";\n\nimport STYLES from \"./KoFi.module.scss\";\n\nconst KoFi = () => {\n  return (\n    <div className={STYLES.kofiContainer}>\n      <a\n        className={STYLES.link}\n        href=\"https://ko-fi.com/tomcorke\"\n        /* eslint-disable-next-line react/jsx-no-target-blank */\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        <img\n          height=\"36\"\n          style={{ border: \"0px\", height: \"36px\" }}\n          src={kofiIcon}\n          alt=\"Buy Me a Coffee at ko-fi.com\"\n        />\n        <span>Buy me a coffee</span>\n      </a>\n    </div>\n  );\n};\n\nexport default KoFi;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAEM0lEQVRoge2Y229VRRSHv93L4VJ6oU14EKHIi4ARY9BEE5UaNZJqMFGQgDEaX0xINMbwAl4QgprGa+R/IAjBoFgJD0ZFE5sAiShYwVqxobGFtmBbyDltT8csZzeHszv7dPalCjJfstPT2WvPzG/WzFozg8PhcDgcDofD4XA4HI7/P56NQqXUSmAXUA5c/g9HpQwYAXqB34BDwCdAzmTseVbyJqOU+l5dveSUUluUUgSfsBGzoS7eUP0rZIA3gU6gcaoGbQVfC9wEnAKWXS+ChRlAKzArzMBWcMzVnyptwG5gP3BMQktI5YuAlkQNK6U6rUJWPq/UxYtKDQ2VthOb7m6lstkokfC+QFBaqJT6LsR2VN6btFSk5oK9e+CrL2F4GMrKYG49NDXBo6uhvFzbHD0C+/ZCVxfkx2B2FdxxJzz9DFRXT9VCcJZ1AfcAe4C1Bl1rgPenqsSIeNgPCma2vwH798EN87UISQki/MIA3HU3vL4NDh2EnR/B7FlQ36AHJZeD7rOw7Bb4cCfUlUwGTcA3hvJGPyeXB8oPep7XnL7g1gOwbSssWapFTOQ/Sfry9PXpv7Lkqmsgk4Hx8cL34v2TJ/RMeG1rHMH/iANWBcpOeZ63JGiYPEq3tUFNTbFY0L9FWEMDVFVBbR1UVhaLFfJ5WNgIP5+E/v64vfjTUFZvMkwueCQHM2cWi70SKRevBgfkSmZk4PIl6DsftxcZQ5kxPiUXPGcOZLP+tI3JqB/A5hqdYsOkqQtcMH2XXPCtyyGbiy9YPC/rfMECmDcvTg23AysM5WeMzcVpoYhVzbCoEXp7CunHFhkkmR2yLB5fE7cHH4SUy0lqEraCR0PfyPrd+IJOQ4OD2mM2iFgJWL93wrPP6fRVmmAAkKxxFFhp+CoPfGyqzTYttYeskwKfH4C3d8D8G3VUDkbjolY9/f70aXhyHby8yaYbXwA/SdQAbgYeLGH7HrDJdB5OT7Dw2afQ8pbegMjOSTw4qUXfsx2/wlprsVGQQVlOyAVAeltLYfVjUFGhPS0erK0tFj39Ys8CD5UySP942PwIbN8B/X0wMFAIZLK2x0a12PVPTYfYr/1Z2FvKaHrOw/c/AC3vwtAQ9PTojYdE444OHaBefCnN1mQf/YS0Clyayth2DR+fWBeRaG+HVzdr0ZUV8PxGWL8hrjCJI8O+qG7gFz/1HAkVl+AS73jsK7w/zii1YZ1Su3fFrsJnsemirtRjHARLwT8At8UbLsniI3otl0XcmBSQa1g50J+L8lGSKD0cqXtBKk17+0iciCo2DNug9WMajSWgNa2KbKf0vcDhaRBiQ4+/sxqM+qFpStt6+FvglRQ6H5W/gIfjiA3D1sMTP2WjvgVY6h+6x/w68v4TrE/+H/cPH6a2xgxlnp965Dr2HSAbW1ySM7rD4XA4HA6Hw+FwXD8AfwPHcRHtjfBbbgAAAABJRU5ErkJggg==\"","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"\n});\n\nfunction SvgGithub(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    role: \"img\",\n    viewBox: \"0 0 24 24\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"GitHub icon\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgGithub);\nexport default __webpack_public_path__ + \"static/media/github.16a9304e.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z\"\n});\n\nfunction SvgTwitter(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    role: \"img\",\n    viewBox: \"0 0 24 24\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"Twitter icon\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgTwitter);\nexport default __webpack_public_path__ + \"static/media/twitter.774c4536.svg\";\nexport { ForwardRef as ReactComponent };","import {\n  DestinyCharacterComponent,\n  DestinyInventoryComponent,\n  DestinyItemComponent,\n  DestinyItemInstanceComponent,\n  DestinyProfileProgressionComponent,\n  DestinyProfileResponse,\n  ServerResponse,\n} from \"bungie-api-ts/destiny2\";\n\nimport forIn from \"lodash/forIn\";\nimport groupBy from \"lodash/groupBy\";\nimport mapValues from \"lodash/mapValues\";\nimport maxBy from \"lodash/maxBy\";\nimport sumBy from \"lodash/sumBy\";\n\nimport {\n  ARTIFACT_INVENTORY_BUCKET_HASH,\n  CLASS_NAMES,\n  CLASS_TYPE_ALL,\n  ITEM_BUCKET_SLOTS,\n  ITEM_POWER_SOFT_CAP,\n  ITEM_SLOT_BUCKETS,\n  ITEM_TYPE_ARMOR,\n  ITEM_TYPE_WEAPON,\n} from \"../constants\";\nimport {\n  ItemBySlot,\n  JoinedItemDefinition,\n  PowerBarsCharacterData,\n  PowerBySlot,\n  SeasonalArtifactData,\n} from \"../types\";\nimport {\n  BungieSystemDisabledError,\n  getFullProfile,\n  getManifest,\n  GetManifestResult,\n  ManifestData,\n  setItemLockState,\n} from \"./bungie-api\";\nimport { auth, getSelectedDestinyMembership } from \"./bungie-auth\";\nimport { debug } from \"./debug\";\nimport eventEmitter, { EVENTS } from \"./events\";\nimport { isMasterwork } from \"./masterwork\";\n\nconst CHARACTER_DISPLAY_ORDER_STORAGE_KEY = \"characterDisplayOrder\";\nconst CACHED_CHARACTER_DATA_STORAGE_KEY = \"cachedCharacterData\";\n\nexport const loadCharacterDisplayOrder = () => {\n  debug(\"loadCharacterDisplayOrder\");\n  const storedValue = localStorage.getItem(CHARACTER_DISPLAY_ORDER_STORAGE_KEY);\n  try {\n    return storedValue ? JSON.parse(storedValue) : undefined;\n  } catch (e) {\n    return undefined;\n  }\n};\n\nexport const saveCharacterDisplayOrder = (characterOrder: string[]) => {\n  debug(\"saveCharacterDisplayOrder\");\n  localStorage.setItem(\n    CHARACTER_DISPLAY_ORDER_STORAGE_KEY,\n    JSON.stringify(characterOrder)\n  );\n};\n\nconst getPowerBySlot = (itemsBySlot: ItemBySlot): PowerBySlot =>\n  mapValues(itemsBySlot, (item) => item?.instanceData?.primaryStat?.value || 0);\n\nconst getAveragePower = (powerBySlot: PowerBySlot) =>\n  Object.values(powerBySlot).reduce((sum, power) => sum + power, 0) /\n  Object.keys(ITEM_SLOT_BUCKETS).length;\nconst getOverallPower = (powerBySlot: PowerBySlot) =>\n  Math.floor(getAveragePower(powerBySlot));\n\nexport const getPower = (itemsBySlot: ItemBySlot) => {\n  const powerBySlot = getPowerBySlot(itemsBySlot);\n  return {\n    averagePower: getAveragePower(powerBySlot),\n    overallPower: getOverallPower(powerBySlot),\n  };\n};\n\nconst mergeItems = <\n  T extends { [key: string]: { items: DestinyItemComponent[] } }\n>(\n  characterItemMap: T\n) => {\n  return Object.values(characterItemMap).reduce(\n    (allItems, characterItems) => allItems.concat(characterItems.items),\n    [] as DestinyItemComponent[]\n  );\n};\n\nconst isItemEquippableByCharacter = (\n  item: JoinedItemDefinition,\n  character: DestinyCharacterComponent\n) => {\n  if (!item.instanceData) {\n    return false;\n  }\n  if (item.instanceData.equipRequiredLevel > character.baseCharacterLevel) {\n    return false;\n  }\n  if (\n    item.itemDefinition.classType !== CLASS_TYPE_ALL &&\n    item.itemDefinition.classType !== character.classType\n  ) {\n    return false;\n  }\n  if (item.instanceData.cannotEquipReason === 16) {\n    return true;\n  } // Only reason is that it's in your vault\n  if (item.instanceData.canEquip) {\n    return true;\n  } // If the game says we can equip it, let's believe it\n  // Let's ignore the rest for now\n  return true;\n};\n\ninterface ObjectOf<T> {\n  [key: string]: T;\n}\n\nconst mapAndFilterItems = (\n  items: DestinyItemComponent[],\n  manifest: ManifestData,\n  itemInstances: ObjectOf<DestinyItemInstanceComponent>,\n  character: DestinyCharacterComponent\n): JoinedItemDefinition[] =>\n  items\n    .map((item) => {\n      const instanceData = item.itemInstanceId\n        ? itemInstances[item.itemInstanceId]\n        : undefined;\n      const itemDefinition =\n        manifest.DestinyInventoryItemDefinition[item.itemHash];\n      return {\n        ...item,\n        instanceData,\n        itemDefinition,\n        itemCategories: itemDefinition?.itemCategoryHashes?.map(\n          (c) => manifest.DestinyItemCategoryDefinition[c]!\n        ),\n      };\n    })\n    .filter(\n      (i) =>\n        i.instanceData &&\n        i.itemDefinition &&\n        [ITEM_TYPE_ARMOR, ITEM_TYPE_WEAPON].includes(i.itemDefinition.itemType)\n    )\n    .map((i) => ({\n      ...i,\n      instanceData: i.instanceData!,\n      itemDefinition: i.itemDefinition!,\n    }))\n    .map((i) => ({\n      ...i,\n      slotName: ITEM_BUCKET_SLOTS[i.itemDefinition.inventory!.bucketTypeHash],\n    }))\n    .filter(\n      (i) => i.instanceData.primaryStat && i.instanceData.primaryStat.value\n    )\n    .filter((i) => isItemEquippableByCharacter(i, character));\n\nconst getItemScore = (\n  item?: JoinedItemDefinition,\n  priorityItems?: DestinyItemComponent[]\n) => {\n  if (!item || !item.instanceData || !item.instanceData.primaryStat) {\n    return 0;\n  }\n  let score = item.instanceData.primaryStat.value;\n  if (\n    priorityItems &&\n    priorityItems.some((pi) => pi.itemInstanceId === item.itemInstanceId)\n  ) {\n    // Prefer items currently equipped on character over items of equal level elsewhere\n    score += 0.5;\n  }\n  if (isMasterwork(item)) {\n    score += 0.25;\n  }\n  if (item.location === 1) {\n    // In inventory\n    score += 0.125;\n  }\n  return score;\n};\n\nconst getEquipLabel = (item?: JoinedItemDefinition) =>\n  item?.itemDefinition.equippingBlock?.uniqueLabel;\n\n// const getEmblemData = (\n//   character: DestinyCharacterComponent,\n//   manifest: ManifestData\n// ) => {\n//   if (!manifest) {\n//     return;\n//   }\n//   return manifest.DestinyInventoryItemDefinition[character.emblemHash];\n// };\n\nconst getDataForCharacterId = (\n  characterId: string,\n  characters: ObjectOf<DestinyCharacterComponent>,\n  itemInstances: ObjectOf<DestinyItemInstanceComponent>,\n  manifest: ManifestData,\n  equippedCharacterItems: DestinyItemComponent[],\n  allCharacterItems: DestinyItemComponent[],\n  profileInventories: DestinyInventoryComponent,\n  profileProgression: DestinyProfileProgressionComponent\n): PowerBarsCharacterData => {\n  debug(\"getDataForCharacterId\", characterId);\n  const character = characters[characterId];\n  const className = CLASS_NAMES[character.classType];\n\n  const characterItems = mapAndFilterItems(\n    allCharacterItems,\n    manifest,\n    itemInstances,\n    character\n  );\n  const relevantProfileItems = mapAndFilterItems(\n    profileInventories.items,\n    manifest,\n    itemInstances,\n    character\n  ).filter(\n    (i) =>\n      i.itemDefinition.classType === CLASS_TYPE_ALL ||\n      i.itemDefinition.classType === character.classType\n  );\n\n  const hasRedactedEquippableItems = allCharacterItems.some((item) => {\n    const itemDefinition =\n      manifest.DestinyInventoryItemDefinition[item.itemHash];\n    return itemDefinition?.redacted && itemDefinition?.equippable;\n  });\n\n  const allItems = characterItems.concat(relevantProfileItems);\n\n  // Group by slot\n  const itemsBySlot = groupBy(allItems, (i) => i.slotName);\n\n  /*\n  const redactedItemsBySlot = groupBy(\n    allItems.filter((i) => i.itemDefinition?.redacted),\n    (i) => i.slotName\n  );\n  debug({ character, redactedItemsBySlot });\n  */\n\n  /*\n  const helm = itemsBySlot.kinetic?.find(\n    (i) => i.itemDefinition?.displayProperties?.name === \"Heritage\"\n  );\n  if (helm) {\n    debug(helm.itemDefinition!.displayProperties!.name, helm);\n    (helm.instanceData.primaryStat as any).value = 1257;\n  }\n  const legs = itemsBySlot.legs?.find(\n    (i) => i.itemDefinition?.displayProperties?.name === \"Transversive Steps\"\n  );\n  if (legs) {\n    debug(\"Transversive Steps\", legs);\n    (legs.instanceData.primaryStat as any).value = 1258;\n  }\n  */\n\n  // Get max power items per slot\n  let topItemBySlot: ItemBySlot = mapValues(\n    itemsBySlot,\n    (items) =>\n      maxBy(items, (item) => getItemScore(item, equippedCharacterItems))!\n  );\n\n  const topUnrestrictedItemBySlot: ItemBySlot = topItemBySlot;\n\n  // Get overlaps by equip label\n  const uniqueEquippedGroups = groupBy(\n    Object.values(topItemBySlot).filter(getEquipLabel),\n    getEquipLabel\n  );\n  // For overlaps with more than one item, generate valid options where all-but-one item is swapped for the next best non-exotic\n  forIn(uniqueEquippedGroups, (uniqueEquippedGroup) => {\n    if (uniqueEquippedGroup.length <= 1) {\n      return;\n    }\n\n    // Create a list of valid _equippable_ item combinations\n    // by excluding those which have more than one item included in the same\n    // \"equip label\" - Destiny's groupings that limit exotics to 1 armour, 1 weapon\n    const validEquippableItemCombinations: ItemBySlot[] = [];\n\n    uniqueEquippedGroup.forEach((item) => {\n      const otherItems: JoinedItemDefinition[] = uniqueEquippedGroup\n        .filter((otherItem) => otherItem !== item)\n        .filter((otherItem) => !!otherItem)\n        .map((otherItem) => otherItem!);\n      let isCombinationValid = true;\n      const combination = { ...topItemBySlot };\n      otherItems.forEach((otherItem) => {\n        // Find non-exotics for this slot\n        const nonExotics = itemsBySlot[otherItem.slotName].filter(\n          (i) => !getEquipLabel(i)\n        );\n        if (nonExotics.length > 0) {\n          // Select max power from non-exotics\n          combination[otherItem.slotName] = maxBy(nonExotics, (i) =>\n            getItemScore(i, equippedCharacterItems)\n          )!;\n        } else {\n          // No non-exotic options for this slot, so whole combination is invalid\n          isCombinationValid = false;\n        }\n      });\n      if (isCombinationValid) {\n        validEquippableItemCombinations.push(combination);\n      }\n    });\n\n    const getCombinationScore = (combination: ItemBySlot) =>\n      sumBy(Object.values(combination), getItemScore);\n\n    // Select highest total scoring valid combination, if alternative item combinations have been generated\n    if (validEquippableItemCombinations.length > 0) {\n      const bestCombination = maxBy(\n        validEquippableItemCombinations,\n        getCombinationScore\n      )!;\n      topItemBySlot = bestCombination;\n    }\n  });\n\n  const LOST_ITEMS_BUCKET = 215593132;\n  Object.values(topItemBySlot).forEach((item) => {\n    if (item && item.bucketHash === LOST_ITEMS_BUCKET) {\n      // Override normally read-only property\n      (item as any).location = 4; // ItemLocation.Postmaster\n    }\n  });\n\n  const powerBySlot = getPowerBySlot(topUnrestrictedItemBySlot);\n\n  const { averagePower: overallPowerExact, overallPower } = getPower(\n    topItemBySlot\n  );\n  const {\n    averagePower: unrestrictedOverallPowerExact,\n    overallPower: unrestrictedOverallPower,\n  } = getPower(topUnrestrictedItemBySlot);\n\n  const artifactItemComponent = allCharacterItems.find(\n    (i) => i.bucketHash === ARTIFACT_INVENTORY_BUCKET_HASH\n  );\n\n  const artifactInstance =\n    artifactItemComponent?.itemInstanceId &&\n    itemInstances[artifactItemComponent.itemInstanceId];\n\n  let artifactData: SeasonalArtifactData | undefined;\n  if (\n    artifactItemComponent &&\n    profileProgression.seasonalArtifact &&\n    artifactInstance\n  ) {\n    const artifactDefinition = manifest.DestinyInventoryItemDefinition[\n      artifactItemComponent.itemHash\n    ]!;\n    artifactData = {\n      bonusPower:\n        profileProgression.seasonalArtifact.powerBonus ||\n        artifactInstance.primaryStat.value,\n      iconPath: artifactDefinition.displayProperties?.icon,\n      name: artifactDefinition.displayProperties?.name || \"Artifact\",\n      progressToNextLevel:\n        profileProgression.seasonalArtifact?.powerBonusProgression\n          ?.progressToNextLevel,\n      nextLevelAt:\n        profileProgression.seasonalArtifact?.powerBonusProgression?.nextLevelAt,\n    };\n  }\n\n  const potentialPowerBySlot = { ...powerBySlot };\n  while (\n    Object.values(potentialPowerBySlot).some(\n      (power) =>\n        power < getOverallPower(potentialPowerBySlot) ||\n        power < ITEM_POWER_SOFT_CAP\n    )\n  ) {\n    const tempPotentialOverallPower = getOverallPower(potentialPowerBySlot);\n    Object.keys(potentialPowerBySlot).forEach(\n      (slot) =>\n        (potentialPowerBySlot[slot] = Math.max(\n          ITEM_POWER_SOFT_CAP,\n          Math.max(tempPotentialOverallPower, potentialPowerBySlot[slot])\n        ))\n    );\n  }\n  const potentialOverallPower = getOverallPower(potentialPowerBySlot);\n\n  const titleDefinition =\n    manifest.DestinyRecordDefinition[character.titleRecordHash || \"\"];\n  const title =\n    titleDefinition &&\n    titleDefinition.titleInfo.titlesByGenderHash[character.genderHash];\n\n  const resultData: PowerBarsCharacterData = {\n    character,\n    className,\n\n    overallPower,\n    overallPowerExact,\n    topItemBySlot,\n\n    unrestrictedOverallPower,\n    unrestrictedOverallPowerExact,\n    topUnrestrictedItemBySlot,\n\n    potentialOverallPower,\n\n    artifactData,\n    title,\n    hasRedactedEquippableItems,\n  };\n\n  return resultData;\n};\n\nconst simpleNumericalHash = (value: string) => {\n  let hash = 0;\n  if (value.length === 0) {\n    return hash;\n  }\n  for (let i = 0; i < value.length; i++) {\n    const char = value.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n};\nconst hashObject = <T extends object>(value: T) => {\n  return simpleNumericalHash(JSON.stringify(value));\n};\n\nlet lastManifestResult: GetManifestResult | undefined;\nlet lastAllCharacterItemsHash: number | undefined;\nlet lastItemInstancesHash: number | undefined;\nlet lastProfileProgressionHash: number | undefined;\nlet lastCharacterData: PowerBarsCharacterData[] | undefined;\n\nexport const getCachedCharacterData = async (\n  setCharacterData: (state: PowerBarsCharacterData[]) => any\n) => {\n  debug(\"getCachedCharacterData\");\n  const dataString = localStorage.getItem(CACHED_CHARACTER_DATA_STORAGE_KEY);\n  if (dataString) {\n    try {\n      const parsedData = JSON.parse(dataString) as PowerBarsCharacterData[];\n      setCharacterData(parsedData);\n    } catch (e) {\n      console.error(`Error parsing cached character data`, e);\n    }\n  }\n};\n\nconst setCachedCharacterData = (data: PowerBarsCharacterData[]) => {\n  localStorage.setItem(CACHED_CHARACTER_DATA_STORAGE_KEY, JSON.stringify(data));\n};\n\nlet isFetchingCharacterData = false;\nexport const getIsFetchingCharacterData = () => {\n  return isFetchingCharacterData;\n};\n\nexport const bustProfileCache = async (\n  characterData: PowerBarsCharacterData[]\n) => {\n  // find a character with a valid item somewhere (just to be safe)\n  const character = characterData.find(\n    (char) =>\n      char.topItemBySlot &&\n      Object.values(char.topItemBySlot).find((v) => v?.itemInstanceId)\n  );\n\n  // find a valid item on our character\n  const item = Object.values(character?.topItemBySlot ?? {}).find(\n    (v) => v?.itemInstanceId\n  );\n\n  if (!item?.itemInstanceId || !character) return;\n\n  // to bust the profile cache, we set the locked state on an item to its *current lock state*.\n  // This might be weird and confusing but it works and it busts the profile cache without\n  // actually changing anything on the user's inventory\n\n  const isLocked = (item.state && item.state & 1) === 1; // ItemState.Locked\n  const payload = {\n    state: isLocked,\n    itemId: item.itemInstanceId,\n    characterId: character?.character.characterId,\n    membershipType: character?.character.membershipType,\n  };\n\n  isFetchingCharacterData = true;\n  eventEmitter.emit(EVENTS.FETCHING_CHARACTER_DATA_CHANGE);\n\n  try {\n    await setItemLockState(payload);\n  } catch (err) {\n    throw err;\n  } finally {\n    isFetchingCharacterData = false;\n    eventEmitter.emit(EVENTS.FETCHING_CHARACTER_DATA_CHANGE);\n  }\n};\n\nexport const getCharacterData = async (\n  setCharacterData: (state: PowerBarsCharacterData[]) => any\n) => {\n  debug(\"getCharacterData\");\n  try {\n    const isAuthed = await auth();\n    if (!isAuthed) {\n      return;\n    }\n\n    const pendingManifest = getManifest();\n\n    isFetchingCharacterData = true;\n    eventEmitter.emit(EVENTS.FETCHING_CHARACTER_DATA_CHANGE);\n\n    const destinyMembership = getSelectedDestinyMembership();\n    if (!destinyMembership) {\n      return;\n    }\n\n    let fullProfile: ServerResponse<DestinyProfileResponse> | undefined;\n    try {\n      fullProfile = await getFullProfile(\n        destinyMembership.membershipType,\n        destinyMembership.membershipId\n      );\n      if (fullProfile.ErrorStatus === \"SystemDisabled\") {\n        throw new BungieSystemDisabledError();\n      }\n    } catch (e) {\n      if (e.message === \"401\") {\n        await auth();\n        fullProfile = await getFullProfile(\n          destinyMembership.membershipType,\n          destinyMembership.membershipId\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    if (\n      !fullProfile ||\n      !fullProfile?.Response?.characters?.data ||\n      !fullProfile?.Response?.characterEquipment?.data ||\n      !fullProfile?.Response?.characterInventories?.data ||\n      !fullProfile?.Response?.profileInventory?.data ||\n      !fullProfile?.Response?.itemComponents?.instances?.data ||\n      !fullProfile?.Response?.profileProgression?.data\n    ) {\n      return;\n    }\n\n    const characters = fullProfile.Response.characters.data;\n    const characterEquipments = fullProfile.Response.characterEquipment.data;\n    const characterInventories = fullProfile.Response.characterInventories.data;\n    const profileInventories = fullProfile.Response.profileInventory.data;\n    const itemInstances = fullProfile.Response.itemComponents.instances.data;\n    const profileProgression = fullProfile.Response.profileProgression.data;\n\n    let manifestResult: GetManifestResult | undefined;\n    try {\n      manifestResult = await pendingManifest;\n    } catch (e) {\n      console.error(e);\n      return;\n    }\n\n    if (!manifestResult || !manifestResult.manifest) {\n      return;\n    }\n\n    const { manifest } = manifestResult;\n\n    const allCharacterItems = mergeItems(characterInventories)\n      .concat(mergeItems(characterEquipments))\n      .concat(profileInventories.items);\n\n    const newAllCharacterItemsHash = hashObject(allCharacterItems);\n    const newItemInstancesHash = hashObject(itemInstances);\n    const newProfileProgressionHash = hashObject(profileProgression);\n\n    debug({\n      lastProfileProgressionHash,\n      newProfileProgressionHash,\n    });\n\n    const queryParams = new URLSearchParams(window.location.search);\n    const queryNoCache = queryParams.get(\"nocache\");\n    const noCache = queryNoCache && queryNoCache.toLowerCase() === \"true\";\n\n    if (\n      !noCache &&\n      newAllCharacterItemsHash === lastAllCharacterItemsHash &&\n      manifestResult === lastManifestResult &&\n      newItemInstancesHash === lastItemInstancesHash &&\n      newProfileProgressionHash === lastProfileProgressionHash &&\n      lastCharacterData\n    ) {\n      // If nothing has changed, don't waste time calculating new best items\n      // when we can return the last set unmodified\n      debug(\"Nothing has changed, returning last calculated character data\");\n      return lastCharacterData;\n    }\n\n    lastManifestResult = manifestResult;\n    lastAllCharacterItemsHash = newAllCharacterItemsHash;\n    lastItemInstancesHash = newItemInstancesHash;\n    lastProfileProgressionHash = newProfileProgressionHash;\n\n    const characterIds = Object.keys(characters);\n    const characterData = characterIds.map((id) =>\n      getDataForCharacterId(\n        id,\n        characters,\n        itemInstances,\n        manifest,\n        characterEquipments[id].items,\n        allCharacterItems,\n        profileInventories,\n        profileProgression\n      )\n    );\n    lastCharacterData = characterData;\n    setCachedCharacterData(characterData);\n    setCharacterData(characterData);\n  } catch (e) {\n    throw e;\n  } finally {\n    isFetchingCharacterData = false;\n    eventEmitter.emit(EVENTS.FETCHING_CHARACTER_DATA_CHANGE);\n  }\n};\n","const VENDOR_ENGRAMS_API_ENDPOINT =\n  \"https://api.vendorengrams.xyz/getVendorDrops?source=destiny-power-bars\";\n\nexport interface VendorEngramsVendorData {\n  vendorID: string;\n  display: string;\n  drop: string;\n  shorthand: string;\n  interval: string;\n  nextRefresh: string;\n}\n\nexport interface VendorEngramsData {\n  data: VendorEngramsVendorData[];\n  updateTimestamp: number;\n}\n\nexport const VENDOR_ENGRAMS_DROP_NO_DATA = \"0\";\nexport const VENDOR_ENGRAMS_DROP_LOW = \"1\";\nexport const VENDOR_ENGRAMS_DROP_HIGH = \"2\";\n\nconst VENDOR_DISPLAY_NAMES: { [shorthand: string]: string } = {\n  devrim: \"Devrim Kay (EDZ)\",\n  sloane: \"Sloane (Titan)\",\n  failsafe: \"Failsafe (Nessus)\",\n  asher: \"Asher Mir (Io)\",\n  zavala: \"Zavala (Vanguard, Tower)\",\n  shaxx: \"Shaxx (Crucible, Tower)\",\n  banshee: \"Banshee-44 (Gunsmith, Tower)\",\n  // benedict: \"Benedict\",\n  // saladin: \"Lord Saladin (Iron Banner, Tower)\",\n  fanboy: \"Brother Vance (Mercury)\",\n  bray: \"Ana Bray (Mars)\",\n  werner: \"Werner 99-40 (Tower, Nessus Barge)\",\n};\nexport const getVendorDisplayName = (shorthand: string) => {\n  return VENDOR_DISPLAY_NAMES[shorthand] || shorthand;\n};\n\nlet vendorEngramsData: VendorEngramsData | undefined;\nlet vendorEngramsRefreshTimer: number | NodeJS.Timeout | undefined;\nlet vendorEngramsRefreshPromise: Promise<VendorEngramsData> | undefined;\n\nconst VENDOR_ENGRAMS_REFRESH_DELAY = 5 * 60 * 1000;\n\nconst refreshVendorEngramsData = async () => {\n  const response = await fetch(VENDOR_ENGRAMS_API_ENDPOINT);\n  const jsonData = (await response.json()) as VendorEngramsVendorData[];\n  const updateTimestamp = Date.now();\n  const data = { data: jsonData, updateTimestamp };\n  vendorEngramsData = data;\n  return data;\n};\n\nexport const getVendorEngramsData = async () => {\n  if (vendorEngramsData) {\n    return vendorEngramsData;\n  }\n  if (!vendorEngramsRefreshPromise) {\n    vendorEngramsRefreshPromise = refreshVendorEngramsData();\n  }\n  if (!vendorEngramsRefreshTimer) {\n    vendorEngramsRefreshTimer = setInterval(() => {\n      refreshVendorEngramsData().catch((e) =>\n        console.warn(\"Error refreshing vendorengrams.xyz data\", e)\n      );\n    }, VENDOR_ENGRAMS_REFRESH_DELAY);\n  }\n  return vendorEngramsRefreshPromise;\n};\n","import SocialLinks from \"./SocialLinks\";\n\nexport default SocialLinks;\n","import React from \"react\";\n\nimport Kofi from \"../KoFi\";\n\nimport { ReactComponent as GitHubLogo } from \"../../images/icons/github.svg\";\nimport { ReactComponent as TwitterLogo } from \"../../images/icons/twitter.svg\";\n\nimport STYLES from \"./SocialLinks.module.scss\";\n\nconst SocialLinks = () => (\n  <div className={STYLES.socialLinks}>\n    <div className={STYLES.link}>\n      <Kofi />\n    </div>\n    <a\n      className={STYLES.link}\n      href=\"https://www.twitter.com/corke_tom\"\n      target=\"_blank\"\n      rel=\"noreferrer noopener\"\n    >\n      <TwitterLogo\n        width={20}\n        height={20}\n        style={{ fill: \"rgba(255,255,255,0.8)\" }}\n      />\n    </a>\n    <a\n      className={STYLES.link}\n      href=\"https://github.com/tomcorke/destiny-power-bars\"\n      target=\"_blank\"\n      rel=\"noreferrer noopener\"\n    >\n      <GitHubLogo\n        width={20}\n        height={20}\n        style={{ fill: \"rgba(255,255,255,0.8)\" }}\n      />\n    </a>\n  </div>\n);\n\nexport default SocialLinks;\n","import Footer from \"./Footer\";\n\nexport default Footer;\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport BuildStamp from \"../BuildStamp\";\nimport SocialLinks from \"../SocialLinks\";\n\nimport STYLES from \"./Footer.module.scss\";\n\ninterface FooterProps {\n  withMobilePadding?: boolean;\n}\n\nconst Footer = ({ withMobilePadding = false }: FooterProps) => {\n  return (\n    <div\n      className={classnames(STYLES.footer, {\n        [STYLES.relative]: withMobilePadding,\n      })}\n    >\n      <div className={STYLES.copy}>Destiny Power Bars &copy; Tom Corke.</div>\n      <SocialLinks />\n      <BuildStamp />\n    </div>\n  );\n};\n\nexport default Footer;\n","import Header from \"./Header\";\n\nexport default Header;\n","import React from \"react\";\n\nimport STYLES from \"./Header.module.scss\";\n\nconst Header = () => (\n  <div className={STYLES.headerContainer}>\n    <div className={STYLES.header}>Destiny Power Bars</div>\n    <div className={STYLES.subHeader}>\n      by{\" \"}\n      <a\n        className={STYLES.author}\n        href=\"https://twitter.com/corke_tom\"\n        rel=\"noreferrer noopener\"\n        target=\"_blank\"\n      >\n        Tom Corke\n      </a>\n    </div>\n  </div>\n);\n\nexport default Header;\n","import classnames from \"classnames\";\nimport React from \"react\";\n\nimport STYLES from \"./LoadingChecklist.module.scss\";\n\nexport type LoadingChecklistItemStatus = \"complete\" | \"pending\" | \"failed\";\n\nexport interface LoadingChecklistItem {\n  label: string;\n  status: LoadingChecklistItemStatus;\n}\n\ninterface LoadingChecklistProps {\n  items: LoadingChecklistItem[];\n  withTopMargin?: boolean;\n}\n\nconst LoadingChecklist = ({ items, withTopMargin }: LoadingChecklistProps) => {\n  return (\n    <div\n      className={classnames(STYLES.LoadingChecklist, {\n        [STYLES.topMargin]: withTopMargin,\n      })}\n    >\n      <ul>\n        {items.map((item) => (\n          <li key={item.label}>\n            <div className={STYLES.item}>\n              <div className={classnames(STYLES.status, STYLES[item.status])} />\n              {item.label}\n            </div>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n};\n\nexport default LoadingChecklist;\n","import LoadingSpinner from \"./LoadingSpinner\";\n\nexport default LoadingSpinner;\n","import React from \"react\";\n\nimport STYLES from \"./LoadingSpinner.module.scss\";\n\ninterface LoadingSpinnerProps {\n  children: string | JSX.Element;\n}\n\nconst LoadingSpinner = ({ children }: LoadingSpinnerProps) => {\n  return (\n    <div className={STYLES.loading}>\n      <div className={STYLES.anchor}>\n        <div className={STYLES.spinnerLarge} />\n        <div className={STYLES.spinnerLargeDouble} />\n        <div className={STYLES.spinnerSmall} />\n        <div className={STYLES.spinnerSmallDouble} />\n      </div>\n      <div className={STYLES.status}>{children}</div>\n    </div>\n  );\n};\n\nexport default LoadingSpinner;\n","import classnames from \"classnames\";\nimport React, { useCallback, useState } from \"react\";\n\nimport STYLES from \"./LazyImage.module.scss\";\n\ninterface LazyImageProps {\n  lowResImage: string;\n  highResImage: string;\n  delay?: number;\n  alt?: string;\n}\n\nexport const LazyImage = ({\n  lowResImage,\n  highResImage,\n  alt = \"\",\n}: LazyImageProps) => {\n  const [highResImageLoaded, setHighResImageLoaded] = useState(false);\n\n  const onHighResImageLoad = useCallback(() => {\n    setHighResImageLoaded(true);\n  }, [setHighResImageLoaded]);\n\n  const result = (\n    <div className={STYLES.lazyImage}>\n      <img\n        src={highResImage}\n        alt={alt}\n        className={classnames({\n          [STYLES.hidden]: !highResImageLoaded,\n          [STYLES.overlay]: !highResImageLoaded,\n        })}\n        onLoad={onHighResImageLoad}\n      />\n      <img\n        src={lowResImage}\n        alt={alt}\n        className={classnames({\n          [STYLES.hidden]: highResImageLoaded,\n          [STYLES.overlay]: highResImageLoaded,\n        })}\n      />\n    </div>\n  );\n\n  return result;\n};\n","export default __webpack_public_path__ + \"static/media/example-titan-character-display-with-info-blur.cbe18dfa.jpg\";","export default __webpack_public_path__ + \"static/media/example-titan-character-display-with-info.2daef1c3.png\";","import React from \"react\";\n\nimport { manualStartAuth } from \"../../services/bungie-auth\";\nimport { LazyImage } from \"../LazyImage\";\n\nimport ExampleTitanCharacterDisplayImageLowRes from \"../../images/screenshots/example-titan-character-display-with-info-blur.jpg\";\nimport ExampleTitanCharacterDisplayImage from \"../../images/screenshots/example-titan-character-display-with-info.png\";\nimport STYLES from \"./LoginPrompt.module.scss\";\n\ninterface LoginPromptProps {\n  onLoginClick?: () => void;\n}\n\nconst DEFAULT_ON_LOGIN_CLICK = () => manualStartAuth();\n\nconst LoginPrompt = ({\n  onLoginClick = DEFAULT_ON_LOGIN_CLICK,\n}: LoginPromptProps) => {\n  return (\n    <div className={STYLES.loginContainer}>\n      <div className={STYLES.exampleImage}>\n        <LazyImage\n          lowResImage={ExampleTitanCharacterDisplayImageLowRes}\n          highResImage={ExampleTitanCharacterDisplayImage}\n          alt=\"Example Destiny Power Bars\"\n        />\n      </div>\n      <div className={STYLES.login}>\n        <div>\n          Destiny Power Bars requires access to your inventory and vault to\n          determine your maximum power per slot and character. Please log in to\n          Bungie.net to authorize this application.\n        </div>\n        <button className={STYLES.loginButton} onClick={onLoginClick}>\n          Log in with Bungie.net\n        </button>\n        {/* <a className={STYLES.loginButton} href={getAuthUrl()}>\n          Log in with Bungie.net\n        </a> */}\n      </div>\n    </div>\n  );\n};\n\nexport default LoginPrompt;\n","import LoginPrompt from \"./LoginPrompt\";\n\nexport default LoginPrompt;\n","import { UserInfoCard } from \"bungie-api-ts/user\";\nimport classnames from \"classnames\";\nimport React from \"react\";\n\nimport { PartialApi } from \"../../services/api\";\nimport STYLES from \"./MembershipSelect.module.scss\";\n\nexport interface RequiredApi extends PartialApi {\n  bungieAuth: {\n    getDestinyMemberships: () => UserInfoCard[] | undefined;\n  };\n}\n\nconst PLATFORMS: { [key: number]: string } = {\n  1: \"xbox\",\n  2: \"psn\",\n  3: \"steam\",\n  4: \"blizzard\",\n  5: \"stadia\",\n};\n\nconst isCrossSavePrimary = (membership: UserInfoCard) => {\n  return (\n    membership.crossSaveOverride &&\n    membership.crossSaveOverride === membership.membershipType\n  );\n};\n\nconst isCrossSaveSecondary = (membership: UserInfoCard) => {\n  return (\n    membership.crossSaveOverride &&\n    membership.crossSaveOverride !== membership.membershipType\n  );\n};\n\nconst titleCase = (s: string = \"\") => {\n  return s.substr(0, 1).toUpperCase() + s.substr(1);\n};\n\ninterface CrossSaveDisplayProps {\n  membership: UserInfoCard;\n}\n\nconst CrossSaveDisplay = ({ membership }: CrossSaveDisplayProps) => {\n  if (membership.applicableMembershipTypes.length === 0) {\n    return null;\n  }\n  return (\n    <div className={STYLES.crossSaveDisplayWrapper}>\n      <div\n        className={STYLES.crossSaveDisplay}\n        title={`Cross-save enabled for: ${membership.applicableMembershipTypes\n          .map((t) => titleCase(PLATFORMS[t]))\n          .join(\", \")}`}\n      >\n        <div className={STYLES.crossSaveIcon} />\n        {membership.applicableMembershipTypes.map((m) => {\n          return (\n            <div\n              key={m}\n              className={classnames(\n                STYLES.crossSaveMembershipIcon,\n                STYLES[`crossSaveMembershipType_${PLATFORMS[m]}`]\n              )}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport interface MembershipSelectProps {\n  onMembershipSelect: (membership: UserInfoCard) => any;\n  api: RequiredApi;\n}\n\nconst MembershipSelect = ({\n  onMembershipSelect,\n  api,\n}: MembershipSelectProps) => {\n  const destinyMemberships = api.bungieAuth.getDestinyMemberships();\n\n  if (!destinyMemberships) {\n    return null;\n  }\n\n  if (destinyMemberships.length === 0) {\n    return <div>No destiny memberships!</div>;\n  }\n\n  return (\n    <div className={STYLES.membershipSelect}>\n      {destinyMemberships\n        .filter((m) => !isCrossSaveSecondary(m))\n        .filter((m) => m.membershipType !== 4)\n        .map((m) => {\n          return (\n            <div\n              key={m.membershipId}\n              className={classnames(\n                STYLES.membership,\n                STYLES[`platform_${PLATFORMS[m.membershipType]}`],\n                {\n                  [STYLES.crossSaveActive]: isCrossSavePrimary(m),\n                  [STYLES.crossSaveDisabled]: isCrossSaveSecondary(m),\n                }\n              )}\n              onClick={() => onMembershipSelect(m)}\n            >\n              <span className={STYLES.membershipDisplayName}>\n                {m.displayName}\n              </span>\n              {isCrossSavePrimary(m) ? (\n                <CrossSaveDisplay membership={m} />\n              ) : null}\n            </div>\n          );\n        })}\n    </div>\n  );\n};\n\nexport default MembershipSelect;\n","import MembershipSelect, { MembershipSelectProps } from \"./MembershipSelect\";\n\nexport default MembershipSelect;\nexport type { MembershipSelectProps };\n","import * as bungieApi from \"./bungie-api\";\nimport * as bungieAuth from \"./bungie-auth\";\nimport * as ga from \"./ga\";\nimport * as utils from \"./utils\";\nimport * as vendors from \"./vendor-engrams\";\n\nexport interface Api {\n  bungieApi: typeof bungieApi;\n  bungieAuth: typeof bungieAuth;\n  ga: typeof ga;\n  utils: typeof utils;\n  vendors: typeof vendors;\n}\n\nexport type BungieApi = typeof bungieApi;\nexport type BungieAuth = typeof bungieAuth;\nexport type GA = typeof ga;\nexport type Utils = typeof utils;\nexport type Vendors = typeof vendors;\n\nexport interface PartialApi {\n  bungieApi?: Partial<BungieApi>;\n  bungieAuth?: Partial<BungieAuth>;\n  ga?: Partial<GA>;\n  utils?: Partial<Utils>;\n  vendors?: Partial<Vendors>;\n}\n\nconst exports = {\n  bungieApi,\n  bungieAuth,\n  ga,\n  utils,\n  vendors,\n};\n\nexport default exports;\n","import RedactedWarning from \"./RedactedWarning\";\n\nexport default RedactedWarning;\n","import React, { useState } from \"react\";\n\nimport { clearStoredManifest } from \"../../services/bungie-api\";\n\nimport STYLES from \"./RedactedWarning.module.scss\";\n\nconst RedactedWarning = () => {\n  const [showMore, setShowMore] = useState(false);\n  const [hide, setHide] = useState(false);\n\n  if (hide) {\n    return null;\n  }\n\n  const redactedMoreLink = (\n    <button onClick={() => setShowMore(true)}>(more details)</button>\n  );\n  const redactedLessLink = (\n    <button onClick={() => setShowMore(false)}>(less details)</button>\n  );\n  const redactedHideLink = (\n    <button onClick={() => setHide(true)}>(hide)</button>\n  );\n\n  const redactedWarningMessage = showMore ? (\n    <div>\n      <p>\n        Redacted equippable items were found in your character or account\n        inventories.\n      </p>\n      <p>\n        Redacted items do not display their power level or item type in the data\n        returned by the API, so we can not use them to calculate your\n        character's maximum equippable power.\n      </p>\n      <p>\n        These items are usually found within recently added content (raids,\n        dungeons) and will be un-redacted soon by Bungie, usually at the next\n        weekly reset.\n      </p>\n      <p>\n        There is nothing we can do to make this data visible quicker, sorry!\n      </p>\n      <p>\n        If you believe this to be an error (or your data seems \"stuck\"), you can\n        try deleting and re-downloading your cached Destiny manifest by{\" \"}\n        <button onClick={() => clearStoredManifest()}>\n          clicking here to clear it\n        </button>\n        .\n      </p>\n      <div className={STYLES.links}>\n        {redactedLessLink}\n        {redactedHideLink}\n      </div>\n    </div>\n  ) : (\n    <>\n      Redacted items detected, maximum power displayed might not be accurate!{\" \"}\n      {redactedMoreLink}\n    </>\n  );\n\n  return <div className={STYLES.redactedWarning}>{redactedWarningMessage}</div>;\n};\n\nexport default RedactedWarning;\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport MembershipSelect, { MembershipSelectProps } from \"../MembershipSelect\";\nimport { logOut } from \"../../services/bungie-auth\";\n\nimport STYLES from \"./MembershipHeader.module.scss\";\n\nconst defaultOnLogout = () => logOut();\n\ntype MembershipHeaderProps = MembershipSelectProps & {\n  isFetchingCharacterData: boolean;\n  onRefreshClick: () => void;\n  onLogout?: () => void;\n};\n\nconst MembershipHeader = ({\n  isFetchingCharacterData,\n  onRefreshClick,\n  onLogout = defaultOnLogout,\n  ...props\n}: MembershipHeaderProps) => {\n  return (\n    <div className={STYLES.membershipHeader}>\n      <button\n        className={classnames(STYLES.hardRefreshButton, {\n          [STYLES.disabled]: isFetchingCharacterData,\n        })}\n        onClick={onRefreshClick}\n      >\n        <div className={STYLES.hardRefreshIcon} />\n        <div className={STYLES.hardRefreshText}>Force Refresh</div>\n      </button>\n      <div className={STYLES.membershipSelect}>\n        <MembershipSelect {...props} />\n      </div>\n      <button\n        className={STYLES.logOutButton}\n        onClick={() => onLogout()}\n        title=\"Log out\"\n      >\n        <div className={STYLES.logOutIcon} />\n        <div className={STYLES.logOutText}>Log out</div>\n      </button>\n    </div>\n  );\n};\n\nexport default MembershipHeader;\n","import MembershipHeader from \"./MembershipHeader\";\n\nexport default MembershipHeader;\n","import React from \"react\";\n\nimport STYLES from \"./GetTrackingPermission.module.scss\";\n\ninterface GetTrackingPermissionProps {\n  onGivePermission: () => void;\n  onDenyPermission: () => void;\n}\n\nconst GetTrackingPermission = ({\n  onGivePermission,\n  onDenyPermission,\n}: GetTrackingPermissionProps) => {\n  return (\n    <div className={STYLES.getTrackingPermission}>\n      <div className={STYLES.floater}>\n        <div className={STYLES.text}>\n          Destiny Power Bars would like to save some basic tracking cookies for\n          Google Analytics. Is this ok?\n        </div>\n        <div className={STYLES.buttons}>\n          <button className={STYLES.yes} onClick={onGivePermission}>\n            yes\n          </button>\n          <button className={STYLES.no} onClick={onDenyPermission}>\n            no\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GetTrackingPermission;\n","import useInterval from \"@use-it/interval\";\nimport { UserInfoCard } from \"bungie-api-ts/user\";\nimport classnames from \"classnames\";\nimport throttle from \"lodash/throttle\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport {\n  auth,\n  hasManuallyAuthed,\n  hasSelectedDestinyMembership,\n  hasValidAuth,\n  manualStartAuth,\n  setSelectedDestinyMembership,\n} from \"./services/bungie-auth\";\nimport ga, { init as gaInit } from \"./services/ga\";\nimport { PowerBarsCharacterData } from \"./types\";\n\nimport CharacterDisplay from \"./components/CharacterDisplay\";\nimport FetchSpinner from \"./components/FetchSpinner\";\nimport Footer from \"./components/Footer\";\nimport LoggedOutHeader from \"./components/LoggedOutHeader\";\nimport {\n  LoadingChecklist,\n  LoadingChecklistItem,\n} from \"./components/LoadingChecklist\";\nimport LoadingSpinner from \"./components/LoadingSpinner\";\nimport LoginPrompt from \"./components/LoginPrompt\";\nimport MembershipSelect from \"./components/MembershipSelect\";\nimport api from \"./services/api\";\nimport { BungieSystemDisabledError, getManifest } from \"./services/bungie-api\";\nimport { EVENTS, useEvent } from \"./services/events\";\nimport {\n  getCachedCharacterData,\n  getCharacterData,\n  getIsFetchingCharacterData,\n  loadCharacterDisplayOrder,\n  saveCharacterDisplayOrder,\n  bustProfileCache,\n} from \"./services/utils\";\nimport RedactedWarning from \"./components/RedactedWarning\";\n\nimport \"normalize.css\";\nimport \"./index.css\";\n\nimport STYLES from \"./App.module.scss\";\nimport { debug } from \"./services/debug\";\nimport MembershipHeader from \"./components/MembershipHeader\";\nimport GetTrackingPermission from \"./components/GetTrackingPermission\";\n\nconst CHARACTER_DATA_REFRESH_TIMER = 15000;\n\nconst doAuth = throttle(\n  (\n    setIsAuthed: (value: boolean) => void,\n    setAuthError: (value: boolean) => void\n  ) => {\n    (async () => {\n      try {\n        const authResult = await auth();\n        if (authResult) {\n          setIsAuthed(true);\n          setAuthError(false);\n        } else {\n          setIsAuthed(false);\n          setAuthError(true);\n        }\n      } catch (e) {\n        console.error(e);\n        setIsAuthed(false);\n        setAuthError(true);\n      }\n    })();\n  },\n  100\n);\n\nconst doGetManifest = throttle(\n  (\n    setBungieSystemDisabled: (value: boolean) => void,\n    setBungieServiceUnavailable: (value: boolean) => void,\n    setManifestError: (value: boolean) => void\n  ) => {\n    (async () => {\n      try {\n        const manifestResult = await getManifest();\n        if (manifestResult.error) {\n          console.error(\n            `Error fetching manifest:`,\n            manifestResult.error.message\n          );\n          setManifestError(true);\n          if (manifestResult.error instanceof BungieSystemDisabledError) {\n            setBungieSystemDisabled(true);\n          }\n          if (manifestResult.error.message === \"503\") {\n            setBungieServiceUnavailable(true);\n          }\n          return;\n        }\n      } catch (e) {\n        console.error(e);\n        setManifestError(true);\n      }\n    })();\n  },\n  500\n);\n\nconst doGetCharacterData = throttle(\n  (\n    setCharacterData: (value: PowerBarsCharacterData[]) => void,\n    setBungieSystemDisabled: (value: boolean) => void,\n    setBungieServiceUnavailable: (value: boolean) => void\n  ) => {\n    const updateCharacterData = (newData: PowerBarsCharacterData[]) => {\n      const newOverallPower = Math.max(...newData.map((c) => c.overallPower));\n      const newArtifactPower = Math.max(\n        ...newData.map((c) => (c.artifactData ? c.artifactData.bonusPower : 0))\n      );\n      const newTotalPower = newOverallPower + newArtifactPower;\n      ga.set({\n        dimension1: `${newOverallPower}`,\n        dimension2: `${newArtifactPower}`,\n        dimension3: `${newTotalPower}`,\n      });\n      setCharacterData(newData);\n    };\n\n    const isFetchingCharacterData = getIsFetchingCharacterData();\n\n    (async () => {\n      if (isFetchingCharacterData) return;\n\n      try {\n        await getCharacterData(updateCharacterData);\n      } catch (error) {\n        if (error instanceof BungieSystemDisabledError) {\n          setBungieSystemDisabled(true);\n        }\n        if (error.message === \"503\") {\n          setBungieServiceUnavailable(true);\n        }\n        console.error(\"Error fetching character data:\", error);\n      }\n    })();\n  },\n  500\n);\n\nconst doHardRefresh = throttle(\n  async (\n    setCharacterData: (value: PowerBarsCharacterData[]) => void,\n    setBungieSystemDisabled: (value: boolean) => void,\n    setBungieServiceUnavailable: (value: boolean) => void,\n    characterData: PowerBarsCharacterData[] | undefined\n  ) => {\n    if (characterData) {\n      try {\n        await bustProfileCache(characterData);\n      } catch (error) {\n        console.error(\n          \"Error busting profile cache, but silently ignoring\",\n          error\n        );\n      }\n    }\n\n    return doGetCharacterData(\n      setCharacterData,\n      setBungieSystemDisabled,\n      setBungieServiceUnavailable\n    );\n  },\n  500\n);\n\nconst getLocalStorageTrackingEnabled = () => {\n  const value = localStorage.getItem(\"tracking-permission-given\");\n  return value && value.toLowerCase() === \"true\";\n};\n\nconst setLocalStorageTrackingEnabled = (value: boolean = true) => {\n  localStorage.setItem(\"tracking-permission-given\", value ? \"true\" : \"false\");\n};\n\nconst getLocalStorageTrackingDenied = () => {\n  const value = localStorage.getItem(\"tracking-permission-denied\");\n  return value && value.toLowerCase() === \"true\";\n};\n\nconst setLocalStorageTrackingDenied = (value: boolean = true) => {\n  localStorage.setItem(\"tracking-permission-denied\", value ? \"true\" : \"false\");\n};\n\nexport const AppWrapper = ({\n  children,\n  top = false,\n  tracking = true,\n}: {\n  children: JSX.Element | (JSX.Element | null)[];\n  top?: boolean;\n  tracking?: boolean;\n}) => {\n  const [trackingPermissionGiven, setTrackingPermissionGiven] = useState(\n    getLocalStorageTrackingEnabled()\n  );\n  const trackingPermissionDenied = getLocalStorageTrackingDenied();\n  const trackingPermissionChoiceMade =\n    trackingPermissionGiven || trackingPermissionDenied;\n\n  if (tracking && !trackingPermissionDenied && trackingPermissionGiven) {\n    gaInit();\n  }\n  return (\n    <div className={STYLES.App}>\n      <div className={classnames(STYLES.AppInner, { [STYLES.top]: top })}>\n        {children}\n      </div>\n      {tracking && !trackingPermissionChoiceMade ? (\n        <GetTrackingPermission\n          onGivePermission={() => {\n            setLocalStorageTrackingEnabled(true);\n            setTrackingPermissionGiven(true);\n          }}\n          onDenyPermission={() => {\n            setLocalStorageTrackingDenied(true);\n            setTrackingPermissionGiven(false);\n          }}\n        />\n      ) : null}\n    </div>\n  );\n};\n\nconst App = () => {\n  const [disableManualLogin, setDisableManualLogin] = useState(\n    hasManuallyAuthed()\n  );\n  const [isAuthed, setIsAuthed] = useState(hasValidAuth());\n  const [hasAuthError, setAuthError] = useState(false);\n\n  const [hasManifestError, setManifestError] = useState(false);\n  const [isBungieSystemDisabled, setBungieSystemDisabled] = useState(false);\n  const [isBungieServiceUnavailable, setBungieServiceUnavailable] = useState(\n    false\n  );\n\n  const [isFetchingCharacterData, setIsFetchingCharacterData] = useState(\n    getIsFetchingCharacterData()\n  );\n\n  useEvent(EVENTS.FETCHING_CHARACTER_DATA_CHANGE, () =>\n    setIsFetchingCharacterData(getIsFetchingCharacterData())\n  );\n\n  const [characterData, setCharacterData] = useState<\n    PowerBarsCharacterData[] | undefined\n  >(undefined);\n\n  const [manifestState, setManifestState] = useState(\"Initialising...\");\n  useEvent(EVENTS.GET_MANIFEST, () => {\n    setManifestError(false);\n    setManifestState(\"Checking manifest version\");\n  });\n  useEvent(EVENTS.LOAD_MANIFEST_DATA, () =>\n    setManifestState(\"Loading manifest data\")\n  );\n  useEvent(EVENTS.FETCH_MANIFEST_DATA, () =>\n    setManifestState(\"Fetching manifest data from Bungie\")\n  );\n  useEvent(EVENTS.PARSE_MANIFEST_DATA, () =>\n    setManifestState(\"Processing manifest data\")\n  );\n  useEvent(EVENTS.STORE_MANIFEST_DATA, () =>\n    setManifestState(\"Saving manifest data\")\n  );\n  useEvent(EVENTS.MANIFEST_DATA_READY, () => {\n    setManifestError(false);\n    setManifestState(\"Manifest ready\");\n  });\n  useEvent(EVENTS.LOG_OUT, () => {\n    setIsAuthed(false);\n    setDisableManualLogin(false);\n  });\n\n  const hasManifestData = manifestState === \"Manifest ready\";\n\n  useEffect(() => {\n    if (!isAuthed) {\n      doAuth(setIsAuthed, setAuthError);\n    }\n  }, [isAuthed, setIsAuthed, setAuthError]);\n\n  useEffect(\n    () =>\n      doGetManifest(\n        setBungieSystemDisabled,\n        setBungieServiceUnavailable,\n        setManifestError\n      ),\n    [setBungieSystemDisabled, setBungieServiceUnavailable, setManifestError]\n  );\n\n  useEvent(EVENTS.MANIFEST_FETCH_ERROR, () => {\n    debug(\"doGetManifest on MANIFEST_FETCH_ERROR\");\n    doGetManifest(\n      setBungieSystemDisabled,\n      setBungieServiceUnavailable,\n      setManifestError\n    );\n  });\n\n  const [\n    hasLoadedCachedCharacterData,\n    setHasLoadedCachedCharacterData,\n  ] = useState(false);\n\n  const hasSelectedMembership = hasSelectedDestinyMembership();\n\n  useEffect(() => {\n    if (isAuthed && hasSelectedMembership && !hasLoadedCachedCharacterData) {\n      setHasLoadedCachedCharacterData(true);\n      getCachedCharacterData(setCharacterData);\n    }\n  }, [\n    isAuthed,\n    hasSelectedMembership,\n    hasLoadedCachedCharacterData,\n    setHasLoadedCachedCharacterData,\n  ]);\n\n  useInterval(() => {\n    if (isAuthed && hasSelectedMembership && !isFetchingCharacterData) {\n      doGetCharacterData(\n        setCharacterData,\n        setBungieSystemDisabled,\n        setBungieServiceUnavailable\n      );\n    }\n  }, CHARACTER_DATA_REFRESH_TIMER);\n\n  useEffect(() => {\n    if (\n      isAuthed &&\n      !characterData &&\n      !isFetchingCharacterData &&\n      !isBungieSystemDisabled\n    ) {\n      doGetCharacterData(\n        setCharacterData,\n        setBungieSystemDisabled,\n        setBungieServiceUnavailable\n      );\n    }\n  }, [\n    isAuthed,\n    characterData,\n    isFetchingCharacterData,\n    isBungieSystemDisabled,\n  ]);\n\n  const onSelectMembership = useCallback((membership: UserInfoCard) => {\n    ga.event({\n      category: \"Platform\",\n      action: \"Select platform\",\n      label: `Membership type: ${membership.membershipType}`,\n    });\n    setSelectedDestinyMembership(membership);\n  }, []);\n\n  const onRefreshClick = () => {\n    doHardRefresh(\n      setCharacterData,\n      setBungieSystemDisabled,\n      setBungieServiceUnavailable,\n      characterData\n    );\n  };\n\n  let status: string | JSX.Element = \"\";\n  if (isBungieSystemDisabled) {\n    status = (\n      <span>\n        Bungie API disabled.\n        <br />\n        Check{\" \"}\n        <a\n          href=\"https://www.bungie.net/en/Help/Article/13125\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Bungie's server and update status page\n        </a>{\" \"}\n        for more information\n      </span>\n    );\n  } else if (isBungieServiceUnavailable) {\n    status = (\n      <span>\n        Bungie API unavailable.\n        <br />\n        Check{\" \"}\n        <a\n          href=\"https://www.bungie.net/en/Help/Article/13125\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Bungie's server and update status page\n        </a>{\" \"}\n        for more information\n      </span>\n    );\n  } else if (hasAuthError) {\n    status = (\n      <span\n        className={STYLES.statusAuthError}\n        onClick={() => manualStartAuth()}\n      >\n        Bungie.net authentication required\n      </span>\n    );\n  } else if (hasManifestError) {\n    status = (\n      <span>\n        Error loading manifest, if this persists try{\" \"}\n        <a href=\"/\">refreshing the page</a>!\n      </span>\n    );\n  } else if (!isAuthed) {\n    status = \"Authenticating...\";\n  } else if (!hasSelectedMembership) {\n    status = \"Waiting for Destiny platform selection...\";\n  } else if (!hasManifestData) {\n    status = manifestState;\n  } else if (!characterData || characterData.length === 0) {\n    if (isFetchingCharacterData) {\n      status = \"Fetching character data...\";\n    } else {\n      status = \"No character data\";\n    }\n  }\n\n  window.characterData = characterData;\n\n  const getDefaultCharacterDisplayOrder = useCallback(\n    () =>\n      characterData ? characterData.map((c) => c.character.characterId) : [],\n    [characterData]\n  );\n\n  const isValidCharacterDisplayOrder = useCallback(\n    (characterIds: string[]) =>\n      characterData &&\n      characterData.length === characterIds.length &&\n      characterIds.every((id) =>\n        characterData.some((c) => c.character.characterId === id)\n      ) &&\n      characterData.every((c) =>\n        characterIds.includes(c.character.characterId)\n      ),\n    [characterData]\n  );\n\n  const [draggingCharacterId, setDraggingCharacterId] = useState<\n    string | undefined\n  >(undefined);\n  const [characterDisplayOrder, setCharacterDisplayOrder] = useState<\n    string[] | undefined\n  >(loadCharacterDisplayOrder());\n  const dropOnCharacterId = useCallback(\n    (dropCharacterId: string) => {\n      if (!draggingCharacterId || draggingCharacterId === dropCharacterId) {\n        return;\n      }\n      const currentCharacterOrder =\n        characterDisplayOrder && characterDisplayOrder.length > 0\n          ? characterDisplayOrder\n          : getDefaultCharacterDisplayOrder();\n\n      const swappedOrder = currentCharacterOrder.slice();\n      swappedOrder.splice(\n        currentCharacterOrder.indexOf(draggingCharacterId),\n        1,\n        dropCharacterId\n      );\n      swappedOrder.splice(\n        currentCharacterOrder.indexOf(dropCharacterId),\n        1,\n        draggingCharacterId\n      );\n\n      saveCharacterDisplayOrder(swappedOrder);\n      setCharacterDisplayOrder(swappedOrder);\n    },\n    [\n      draggingCharacterId,\n      characterDisplayOrder,\n      setCharacterDisplayOrder,\n      getDefaultCharacterDisplayOrder,\n    ]\n  );\n\n  let useCharacterOrder = getDefaultCharacterDisplayOrder();\n  if (\n    characterData &&\n    characterData.length > 0 &&\n    characterDisplayOrder &&\n    characterDisplayOrder.length > 0\n  ) {\n    // Validate that character IDs in display order match\n    if (isValidCharacterDisplayOrder(characterDisplayOrder)) {\n      useCharacterOrder = characterDisplayOrder;\n    } else {\n      setCharacterDisplayOrder(undefined);\n    }\n  }\n\n  if (isAuthed && characterData && characterData.length > 0) {\n    const showRedactedWarning = characterData.some(\n      (c) => c.hasRedactedEquippableItems\n    );\n\n    return (\n      <>\n        <AppWrapper top>\n          <MembershipHeader\n            api={api}\n            onMembershipSelect={onSelectMembership}\n            isFetchingCharacterData={isFetchingCharacterData}\n            onRefreshClick={onRefreshClick}\n          />\n          <div className={STYLES.charactersContainer}>\n            <div className={STYLES.characters}>\n              {useCharacterOrder\n                .map((characterId) =>\n                  characterData.find(\n                    (c) => c.character.characterId === characterId\n                  )\n                )\n                .map((c, i) => (\n                  <CharacterDisplay\n                    key={c!.character.characterId}\n                    data={c!}\n                    onDragStart={() =>\n                      setDraggingCharacterId(c!.character.characterId)\n                    }\n                    onDragEnd={() => setDraggingCharacterId(undefined)}\n                    onDragDrop={() =>\n                      dropOnCharacterId(c!.character.characterId)\n                    }\n                  />\n                ))}\n            </div>\n          </div>\n          {showRedactedWarning ? <RedactedWarning /> : null}\n          {/* <VendorDisplay manifestData={manifestData} /> */}\n          {status ? <LoadingSpinner>{status}</LoadingSpinner> : null}\n          {isFetchingCharacterData ? <FetchSpinner /> : null}\n        </AppWrapper>\n        {/* <S10Overlay /> */}\n        <Footer withMobilePadding />\n      </>\n    );\n  }\n\n  if (hasAuthError && !disableManualLogin) {\n    return (\n      <>\n        <AppWrapper>\n          <LoggedOutHeader />\n          <LoginPrompt />\n        </AppWrapper>\n        <Footer />\n      </>\n    );\n  }\n\n  const loadingChecklistItems: LoadingChecklistItem[] = [];\n  const addToChecklist = (\n    label: string,\n    isComplete: boolean,\n    isFailed?: boolean\n  ) =>\n    loadingChecklistItems.push({\n      label,\n      status: isComplete ? \"complete\" : isFailed ? \"failed\" : \"pending\",\n    });\n  addToChecklist(\"Authenticated\", isAuthed, hasAuthError);\n  addToChecklist(\"Loaded Character Data\", !!characterData);\n  addToChecklist(\n    \"Loaded Destiny Manifest Defintions\",\n    hasManifestData,\n    hasManifestError\n  );\n\n  return (\n    <>\n      <AppWrapper>\n        <MembershipSelect api={api} onMembershipSelect={onSelectMembership} />\n        <LoadingChecklist withTopMargin items={loadingChecklistItems} />\n        <LoadingSpinner>{status}</LoadingSpinner>\n      </AppWrapper>\n      <Footer />\n    </>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n}\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              config?.onUpdate?.(registration);\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              config?.onSuccess?.(registration);\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App\":\"App_App__35XJ5\",\"AppInner\":\"App_AppInner__7rbl8\",\"top\":\"App_top__3_oRx\",\"loadingContainer\":\"App_loadingContainer__3jdku\",\"charactersContainer\":\"App_charactersContainer__3vb5J\",\"characters\":\"App_characters__plmyj\",\"loadingStatus\":\"App_loadingStatus__2ivDH\",\"statusAuthError\":\"App_statusAuthError__XCgEU\",\"header\":\"App_header__2n59Q\",\"christmas_0\":\"App_christmas_0__3Ls6_\",\"christmas_1\":\"App_christmas_1__1otSs\",\"christmas_2\":\"App_christmas_2__2UgF8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"getTrackingPermission\":\"GetTrackingPermission_getTrackingPermission__1hdLY\",\"floater\":\"GetTrackingPermission_floater__3cGU7\",\"buttons\":\"GetTrackingPermission_buttons__lKgmK\",\"yes\":\"GetTrackingPermission_yes__VcyNJ\",\"no\":\"GetTrackingPermission_no__RpzOf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"LoadingChecklist\":\"LoadingChecklist_LoadingChecklist__2Emup\",\"topMargin\":\"LoadingChecklist_topMargin__2D9n2\",\"item\":\"LoadingChecklist_item__GVVhb\",\"status\":\"LoadingChecklist_status__34UZS\",\"complete\":\"LoadingChecklist_complete__1XItd\",\"pending\":\"LoadingChecklist_pending__1z0Mj\",\"failed\":\"LoadingChecklist_failed__3SQae\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"lazyImage\":\"LazyImage_lazyImage__3spY4\",\"hidden\":\"LazyImage_hidden__69uHm\",\"overlay\":\"LazyImage_overlay__2HWg-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"anchor\":\"FetchSpinner_anchor__o_Y3W\",\"spinner\":\"FetchSpinner_spinner__1RSBy\",\"spin\":\"FetchSpinner_spin__3E8S5\",\"fetchSpinnerContainer\":\"FetchSpinner_fetchSpinnerContainer__2M1q6\",\"spinnerSmall\":\"FetchSpinner_spinnerSmall__1ONCp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"socialLinks\":\"SocialLinks_socialLinks__2Pxui\",\"link\":\"SocialLinks_link__227SI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerContainer\":\"Header_headerContainer__pT_UF\",\"header\":\"Header_header__1TtCl\",\"subHeader\":\"Header_subHeader__1N7TT\",\"author\":\"Header_author__2RQ4w\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loginContainer\":\"LoginPrompt_loginContainer__3gxdp\",\"exampleImage\":\"LoginPrompt_exampleImage__1B99r\",\"login\":\"LoginPrompt_login__2PASE\",\"loginButton\":\"LoginPrompt_loginButton__hE7Vh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"footer\":\"Footer_footer__L-Qdc\",\"copy\":\"Footer_copy__2L7hA\",\"relative\":\"Footer_relative__7Up8g\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"kofiContainer\":\"KoFi_kofiContainer__2RFIk\",\"link\":\"KoFi_link__3u-lN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"redactedWarning\":\"RedactedWarning_redactedWarning__3OsX7\",\"links\":\"RedactedWarning_links__QTpfz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"hints\":\"PowerHints_hints__1czaE\",\"hint\":\"PowerHints_hint__zxK88\",\"dropHint\":\"PowerHints_dropHint__1TooR\",\"worldDropHint\":\"PowerHints_worldDropHint__1i8pQ\",\"legendaryWorldDropHint\":\"PowerHints_legendaryWorldDropHint__2BLrs\",\"powerfulHint\":\"PowerHints_powerfulHint__1egpr\",\"pinnacleHint\":\"PowerHints_pinnacleHint__2CMGT\",\"separator\":\"PowerHints_separator__3fuT5\",\"hintExtra\":\"PowerHints_hintExtra__3CXr2\",\"hintExtraInner\":\"PowerHints_hintExtraInner__3KN7I\",\"toggleCheckbox\":\"PowerHints_toggleCheckbox__213BS\",\"switch\":\"PowerHints_switch__1epi5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"barWrapper\":\"PowerBar_barWrapper__2ef-L\",\"generalLabel\":\"PowerBar_generalLabel__2f-ZW\",\"specificLabel\":\"PowerBar_specificLabel__1YcCq\",\"iconWrapper\":\"PowerBar_iconWrapper__1iSyn\",\"icon\":\"PowerBar_icon__1ty-U\",\"barContainer\":\"PowerBar_barContainer__22u-q\",\"barLine\":\"PowerBar_barLine__2hv6j\",\"filledBar\":\"PowerBar_filledBar__3kUVd\",\"label\":\"PowerBar_label__euvZO\",\"power\":\"PowerBar_power__3B45G\",\"max\":\"PowerBar_max__WLx7x\",\"belowAverage\":\"PowerBar_belowAverage__2VG8Z\",\"vaultOverlay\":\"PowerBar_vaultOverlay__kuS5U\",\"postmasterOverlay\":\"PowerBar_postmasterOverlay__3drFr\",\"masterworkOverlay\":\"PowerBar_masterworkOverlay__1vADF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inlinePowerNumber\":\"Power_inlinePowerNumber__3mdPk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buildStamp\":\"BuildStamp_buildStamp__28KQY\"};"],"sourceRoot":""}